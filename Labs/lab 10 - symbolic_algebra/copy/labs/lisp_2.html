<!DOCTYPE html>

<html>
<head>
<!-- This page was generated by CAT-SOOP 19.0.6+hg.14.f36ce1d1.  miau. -->
<meta charset="utf-8"/>
<title>LISP Interpreter, Part 2 | 6.101 Spring 2025</title>
<link href="https://py.mit.edu/_static/spring25/logo.gif" rel="icon" type="image/gif"/>
<!-- include catsoop base css -->
<link href="https://py.mit.edu/_static/_base/themes/base.css" rel="stylesheet" type="text/css"/>
<!-- set up JS namespace for catsoop -->
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    var catsoop = {plugins: {}};

    function toggleResponsiveHeader(){
        document.getElementsByTagName('header')[0].classList.toggle('responsive');
    }

    function toggleAttribute(elt, attr){
        elt.setAttribute(attr, elt.getAttribute(attr) === "true" ? "false" : "true");
    }

    catsoop.topMenuFocus = function(event) {
        var elt = event.target;
        var target = event.relatedTarget;
        if (elt.classList.contains('menu-submenu')){
            var topmenu = elt.parentNode.parentNode;
            if (target && !target.classList.contains("menu-submenu") && target !== topmenu.children[1]) {
                clearMenu(topmenu);
            }
        }else if (!target.classList.contains('cs_top_menu_item')){
            clearMenu(elt.parentNode);
        }
    }

    window.addEventListener('DOMContentLoaded', function(){
        var menu_boxes = document.getElementsByClassName('dropdown-checkbox');
        for(var i=0; i<menu_boxes.length; i++){
            menu_boxes[i].checked = false;
        }
    });

    function clearMenu(menu){
       menu.children[1].checked = false;
    }
    // @license-end
    </script>
<!-- dark mode -->
<script src="https://py.mit.edu/_static/_base/js/darkreader/darkreader.min.js" type="text/javascript"></script>
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    catsoop.dark_mode_settings = null;
    if (catsoop.dark_mode_settings === null){
        catsoop.dark_mode_settings = JSON.parse(localStorage.getItem('catsoop_dark_mode_settings'));
        if (catsoop.dark_mode_settings === null){
            catsoop.dark_mode_settings = {'mode': 'disabled', 'brightness': 100, 'contrast': 90, 'sepia': 10, 'grayscale': 0};
        }
    }
    localStorage.setItem('catsoop_dark_mode_settings', JSON.stringify(catsoop.dark_mode_settings));
    catsoop.dark_mode = catsoop.dark_mode_settings.mode;
    delete catsoop.dark_mode_settings.mode;
    if (catsoop.dark_mode === 'enabled' || catsoop.dark_mode === 'auto'){
        DarkReader[catsoop.dark_mode == 'enabled' ? 'enable' : 'auto'](catsoop.dark_mode_settings);
    }
    
    document.addEventListener("DOMContentLoaded", function(event) {
        if (DarkReader.isEnabled()) {
            var invertfilter = 'invert(100%) hue-rotate(180deg)' +
                               ' brightness(' + catsoop.dark_mode_settings.brightness + '%)' +
                               ' contrast(' + catsoop.dark_mode_settings.contrast + '%)' +
                               ' grayscale(' + catsoop.dark_mode_settings.grayscale + '%)' +
                               ' sepia(' + catsoop.dark_mode_settings.sepia + '%)'
            var inverter = document.createElement('style');
            inverter.innerText = 'img.catsoop-darkmode-invert, video.catsoop-darkmode-invert {filter: ' + invertfilter + ';}\n\n'
            document.head.appendChild(inverter);
        }
    });
    // @license-end
    </script>
<!-- load in mathjax and CAT-SOOP-specific math rendering  -->
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    MathJax = {
      startup: {
        typeset: false,
      }
    }

    catsoop.render_math = function (elt) {
        if(elt.classList.contains('cs_displaymath')){
            var b = "\\[";
            var e = "\\]";
        }else{
            var b = "\\(";
            var e = "\\)";
        }
        elt.innerText = b + elt.innerText + e;
        MathJax.typeset([elt]);
        elt.classList.remove('cs_math_to_render');
    }


    catsoop.render_all_math = function (elt){
        if (elt === null) {
            return;
        }
        var mathelts = elt.getElementsByClassName('cs_math_to_render');
        while(mathelts.length > 0){
            catsoop.render_math(mathelts[0]);
        }
    }
    document.addEventListener("DOMContentLoaded", function(event) {
          catsoop.render_all_math(document);
    });
    // @license-end
    </script>
<script id="MathJax-script" src="https://py.mit.edu/_static/_base/js/mathjax/tex-chtml-full-speech.js"></script>
<!-- load in diagram stuff -->
<script src="https://py.mit.edu/_static/_base/js/cs_diagrams.js" type="text/javascript"></script>
<script type="text/javascript">
        catsoop.diagram_sources = {};
    </script>
<!-- Syntax Highlighting -->
<script src="https://py.mit.edu/_static/_base/js/highlight/highlight.min.js" type="text/javascript"></script>
<script src="https://py.mit.edu/_static/_base/js/highlightjs-line-numbers.js" type="text/javascript"></script>
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    catsoop.syntax_highlighting = function (elt) {
        if (elt === null) {
            return;
        }
        elt.querySelectorAll('pre > code:not(.highlighted)').forEach((block) => {
            hljs.highlightBlock(block);
            var wrap = document.createElement("section");
            wrap.setAttribute("aria-label", "Code block");
            block.parentNode.replaceWith(wrap);
            wrap.append(block.parentNode);
            block.classList.add('highlighted');
        });
        elt.querySelectorAll('code.highlight-lines').forEach(function(b){
            hljs.lineNumbersBlock(b);
            if ((b.innerHTML.trim().match(/\r\n|\r|\n/g) || []).length > 0){
                b.parentElement.style = "padding-left: 0px !important;"
                b.classList.add('hljs');
            }
            b.classList.remove('highlight-lines');
        });
    }
    window.addEventListener('DOMContentLoaded', function(){
        catsoop.syntax_highlighting(document);
    });
    // @license-end
    </script>
<style>
      :root {
        --cs-base-bg-color: #0350ba;
        --cs-light-bg-color: #629ced;
        --cs-base-font-color: #fff;
        --cs-light-font-color: #000;
    }
    </style>
<style>
.cs_top_menu_item {
  font-size: 0.88rem;
}
div.dropdown {
  -moz-transform: translateY(-1px);
}
img {
  max-width:100% !important;
}
.visually-hidden {
	position: absolute !important;
	width: 1px !important;
	height: 1px !important;
	padding: 0 !important;
	margin: -1px !important;
	overflow: hidden !important;
	clip: rect(0,0,0,0) !important;
	white-space: nowrap !important;
	border: 0 !important;
}
kbd {
  background-color: #eee;
  border-radius: 3px;
  border: 1px solid #b4b4b4;
  box-shadow:
    0 1px 1px rgba(0, 0, 0, 0.2),
    0 2px 0 0 rgba(255, 255, 255, 0.7) inset;
  color: #333;
  display: inline-block;
  font-size: 0.85em;
  font-weight: 700;
  line-height: 1;
  padding: 2px 4px;
  white-space: nowrap;
}
</style>
<style>
[id^=cs_qdiv].question-lab101 [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101 [id$=nsubmits_left] {
  display: none;
}

[id^=cs_qdiv].question-lab101_vprof [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101_vprof [id$=nsubmits_left] {
  display: none;
}

</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
document.addEventListener("DOMContentLoaded", function(){
    sessionStorage.setItem("last-non-settings", catsoop.this_path);
});
// @license-end
</script>
<script type="text/javascript">
function reload_code_submit() {
    fetch("?action=render_single_question&name=code_submit")
      .then((result) => {return result.text();})
      .then(result => {
        document.getElementById("cs_qdiv_code_submit").innerHTML = result;
        catsoop.run_all_scripts("cs_qdiv_code_submit");
       });
}

</script>
<script src="https://py.mit.edu/_static/_handler/default/cs_ajax.js" type="text/javascript"></script>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
</head>
<body style="margin: 0px;">
<header id="cs_header">
<div aria-role="menubar" class="nav-container">
<div class="cs_header_text"><a href="https://py.mit.edu/spring25"><img src="https://py.mit.edu/_static/spring25/logo.gif"/>Â 6.101</a></div>
<div class="dropdown" onmouseleave="clearMenu(this);">
<label class="dropbtn cs_top_menu_item" for="cs_menu_c1a43e3f699a1ed71997b0321c2e9ffd">Information<span aria-hidden="true" class="downarrow">â¼</span></label>
<input checked="false" class="dropdown-checkbox screenreader-only-clip menu-toplevel" id="cs_menu_c1a43e3f699a1ed71997b0321c2e9ffd" onblur="catsoop.topMenuFocus(event);" role="menuitemcheckbox" type="checkbox"/>
<div class="dropdown-content">
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/basics" onblur="catsoop.topMenuFocus(event);" role="menuitem">Basics and Schedule</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/grading" onblur="catsoop.topMenuFocus(event);" role="menuitem">Grading Policies</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/academic_integrity" onblur="catsoop.topMenuFocus(event);" role="menuitem">Academic Integrity</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/help" onblur="catsoop.topMenuFocus(event);" role="menuitem">Getting Help</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/infrastructure" onblur="catsoop.topMenuFocus(event);" role="menuitem">Infrastructure</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/staff" onblur="catsoop.topMenuFocus(event);" role="menuitem">Staff List</a></div></div>
<div class="dropdown" onmouseleave="clearMenu(this);">
<label class="dropbtn cs_top_menu_item" for="cs_menu_ee51a2d5002bd02613936bd9b2f3dbee">Materials<span aria-hidden="true" class="downarrow">â¼</span></label>
<input checked="false" class="dropdown-checkbox screenreader-only-clip menu-toplevel" id="cs_menu_ee51a2d5002bd02613936bd9b2f3dbee" onblur="catsoop.topMenuFocus(event);" role="menuitemcheckbox" type="checkbox"/>
<div class="dropdown-content">
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/calendar" onblur="catsoop.topMenuFocus(event);" role="menuitem">Calendar</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/readings" onblur="catsoop.topMenuFocus(event);" role="menuitem">Readings</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/labs" onblur="catsoop.topMenuFocus(event);" role="menuitem">Labs</a></div></div>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring25/progress" onblur="catsoop.topMenuFocus(event);" role="menuitem">Progress</a>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring25/queue" onblur="catsoop.topMenuFocus(event);" role="menuitem">Queue</a>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring25/labs/lisp_2?loginaction=login" onblur="catsoop.topMenuFocus(event);" role="menuitem">Log In</a><a class="icon" href="javascript:void(0);" onclick="toggleResponsiveHeader()">â°</a>
</div>
</header>
<nav aria-label="Breadcrumbs" class="cs_navigation cs_top_navigation" id="cs_breadcrumbs"><li><a href="https://py.mit.edu/spring25">Home</a></li><li><a href="https://py.mit.edu/spring25/labs/lisp_2">LISP Interpreter, Part 2</a></li></nav>
<div class="cs_body" id="cs_body">
<div class="cs_left_menu"></div>
<div class="cs_content">
<div class="cs_page_body" role="main">
<center><h1 class="cs_content_header">LISP Interpreter, Part 2</h1></center>
<div class="response" id="catsoop_login_box">
<b><center>You are not logged in.</center></b><br/>
Please <a href="https://py.mit.edu/spring25/labs/lisp_2?loginaction=login">Log
In</a> for full access to the web site.<br/>Note that this link will take you to
an external site (<tt>https://shimmer.mit.edu</tt>) to authenticate, and then you will be redirected
back to this page.
</div>
<style>
html {
    color: #333;
}
</style>
<h2 aria-hidden="true">Table of Contents</h2><ul aria-label="Table of Contents" role="navigation"><li><a href="#_preparation">1) Preparation</a></li><li><a href="#_introduction">2) Introduction</a></li><li><a href="#_schemesyntaxerrors">3) SchemeSyntaxErrors</a></li><li><a href="#_conditionals">4) Conditionals</a></li><ul><li><a href="#_booleans_and_comparisons">4.1) Booleans and Comparisons</a></li><li><a href="#_example_programs">4.2) Example Programs</a></li><ul><li><a href="#_absolute_value">4.2.1) Absolute Value</a></li><li><a href="#_factorial">4.2.2) Factorial</a></li></ul></ul><li><a href="#_lists">5) Lists</a></li><ul><li><a href="#_pairs">5.1) Pairs</a></li><ul><li><a href="#_car_and_cdr">5.1.1) <code>car</code> and <code>cdr</code></a></li></ul><li><a href="#_lists_2">5.2) Lists</a></li><ul><li><a href="#_and_empty_lists">5.2.1) <code>()</code> and Empty Lists</a></li><li><a href="#_linked_lists">5.2.2) Linked Lists</a></li></ul><li><a href="#_built_in_list_functions">5.3) Built-in List Functions</a></li><li><a href="#_example_programs_2">5.4) Example Programs</a></li><ul><li><a href="#_home_on_the_range">5.4.1) Home on the Range</a></li><li><a href="#_flatten_list">5.4.2) Flatten List</a></li></ul></ul><li><a href="#_evaluating_multiple_expressions">6) Evaluating Multiple Expressions</a></li><li><a href="#_reading_from_files">7) Reading From Files</a></li><li><a href="#_command_line_arguments">8) Command-Line Arguments</a></li><li><a href="#_map_filter_and_reduce">9) Map, Filter, and Reduce</a></li><ul><li><a href="#_implementation">9.1) Implementation</a></li></ul><li><a href="#_variable_binding_manipulation">10) Variable-Binding Manipulation</a></li><ul><li><a href="#_del">10.1) <code>del</code></a></li><li><a href="#_let">10.2) <code>let</code></a></li><li><a href="#_set">10.3) <code>set!</code></a></li></ul><li><a href="#_endnotes_and_commentary">11) Endnotes and Commentary</a></li><li><a href="#_code_submission">12) Code Submission</a></li><li><a href="#_optional_improvements_and_extensions" label="optional">13) Optional Improvements and Extensions</a></li><ul><li><a href="#_tail_call_optimization">13.1) Tail-Call Optimization</a></li><li><a href="#_additional_optional_improvements_and_exercises">13.2) Additional (Optional) Improvements and Exercises</a></li></ul></ul>



<p><a class="anchor" name="catsoop_section_1"></a><a class="anchor" name="_preparation"></a><h2 class="cs_section_title">1) Preparation<a class="cs_permalink" href="#_preparation">Â§</a></h2></p>
<p>This lab assumes you have Python 3.11+ installed on your machine (3.13
recommended).</p>
<p>The following file contains code and other resources as a starting point for
this lab: <a download="lisp_2.zip" href="https://py.mit.edu/spring25/lab_distribution.zip?path=%5B%22spring25%22%2C+%22labs%22%2C+%22lisp_2%22%5D"><tt>lisp_2.zip</tt></a></p>
<p>You should start by copying your <code>lab.py</code> file from <a href="https://py.mit.edu/spring25/labs/lisp_1">Lisp Part
1</a> into this week's distribution.  Most of your
changes will be made to this file.</p>
<p>Your raw score for this lab will be out of 5 points:</p>
<ul>
<li>answering the questions on this page (0.5 points),</li>
<li>passing the automatic style check (1 point), and</li>
<li>passing the test cases in <code>test.py</code> (3.5 points).</li>
</ul>
<div class="callout callout-error"><div class="callout-title">Please Start Early</div>
<p>You are <strong>strongly</strong> encouraged to start this lab early if possible.</p>
</div>
<div class="callout callout-error"><div class="callout-title">Reminder: Academic Integrity</div>
<p>Please also review the <a href="https://py.mit.edu/spring25/info/academic_integrity">academic-integrity policies</a> before
continuing.  In particular, <strong>note that you are not allowed to use any code
other than that which you have written yourself, including code from online
sources, AI, and advanced code-completion tools.</strong></p>
</div>
<p><a class="anchor" name="catsoop_section_2"></a><a class="anchor" name="_introduction"></a><h2 class="cs_section_title">2) Introduction<a class="cs_permalink" href="#_introduction">Â§</a></h2></p>
<p>In the Lisp Part 1 lab, you implemented an interpreter for a dialect of <a href="https://en.wikipedia.org/wiki/Lisp_%28programming_language%29" target="_blank">LISP</a> called
Scheme.  This lab builds on your work from last week to introduce some new
features, and we'll also ask you to implement a couple of small programs in
Scheme yourself.  If you have not yet finished part 1, you should do so before
working on this lab.</p>
<p>As a starting point for this lab, copy your code into this week's lab.py file,
but take care to preserve the code under <code>if __name__ == "__main__"</code> in this
week's distribution, since it has changed a little bit from last week.</p>
<p>Your code should pass the <code>test_oldbehaviors</code> test cases with no modification
to your code from last week.  (Note, however, that we did add at least one new
test, based on common student problems from last week that we thought would be
good to help you catch before continuing!)</p>
<p><a class="anchor" name="catsoop_section_3"></a><a class="anchor" name="_schemesyntaxerrors"></a><h2 class="cs_section_title">3) SchemeSyntaxErrors<a class="cs_permalink" href="#_schemesyntaxerrors">Â§</a></h2></p>
<p>In the previous week's lab, we expected that all of the inputs into our Scheme
interpreter did not contain any syntax errors. This lab, we'll start by
implementing some syntax error checking so that our REPL doesn't crash if we
forget a <code>)</code>. In particular, in the case where an expression is not well-formed,
the <code>parse</code> function should raise a <code>SchemeSyntaxError</code>.</p>
<p>For example, after adding correct handling of expression syntax checking,
the following examples should all raise a <code>SchemeSyntaxError</code> in <code>parse</code>:</p>
<pre><code class="nohighlight">in&gt; (+ x 2))
SchemeSyntaxError
in&gt; (+ x 1) (+ x 2)
SchemeSyntaxError
in&gt; )(bad-paren)(
SchemeSyntaxError
</code></pre>
<p>After implementing expression syntax handling, the two syntax error
checking test cases should pass.</p>
<p><a class="anchor" name="catsoop_section_4"></a><a class="anchor" name="_conditionals"></a><h2 class="cs_section_title">4) Conditionals<a class="cs_permalink" href="#_conditionals">Â§</a></h2></p>
<p>Our lab from last time could do some neat things, but it was still somewhat
limited.  One glaring deficiency is the lack of conditionals,
so we'll start this week's portion by adding support for conditional execution
via the <code>if</code> special form<a class="anchor" name="catsoop_footnote_ref_1"></a><a href="#catsoop_footnote_1"><sup>1</sup></a>, which has the following form: <code>(if PRED TRUE_EXP FALSE_EXP)</code></p>
<p>To evaluate this form, we need to first evaluate <code>PRED</code> (the
predicate).  If <code>PRED</code> evaluates to true, the result of this
expression is the result of evaluating <code>TRUE_EXP</code>; if <code>PRED</code> instead
evaluates to false, the result of this expression is the result of
evaluating <code>FALSE_EXP</code>.  Note that we should <strong>never</strong> need to
evaluate both <code>TRUE_EXP</code> and <code>FALSE_EXP</code> when evaluating an <code>if</code>
expression (for this reason, we cannot implement <code>if</code> as a function;
it <em>must</em> be a special form).</p>
<div class="question"><b>Check Yourself:</b><p><p>Why is it important that <code>if</code> only evaluates one of the branches?  Can you
think of a situation where evaluating both branches would be problematic?
</p></p><p><span id="queue_checkyourself_1"></span></p></div>
<p><a class="anchor" name="catsoop_section_4_1"></a><a class="anchor" name="_booleans_and_comparisons"></a><h3 class="cs_section_title">4.1) Booleans and Comparisons<a class="cs_permalink" href="#_booleans_and_comparisons">Â§</a></h3></p>
<p>In order to implement <code>if</code>, we will need a way to represent Boolean values in
Scheme.  This decision is up to you, but no matter your choice of
representation, you should make these values available inside of Scheme as
literals <code>#t</code> and <code>#f</code>, respectively.  We will also need several additional
<em>built-in</em> functions, all of which should take arbitrarily many arguments:</p>
<ul>
<li><code>equal?</code> should evaluate to true if all of its arguments are equal to each other.</li>
<li><code>&gt;</code> should evaluate to true if its arguments are in decreasing order.</li>
<li><code>&gt;=</code> should evaluate to true if its arguments are in nonincreasing order.</li>
<li><code>&lt;</code> should evaluate to true if its arguments are in increasing order.</li>
<li><code>&lt;=</code> should evaluate to true if its arguments are in nondecreasing order.</li>
</ul>
<p>As well as the following Boolean combinators:</p>
<ul>
<li><code>and</code> should be a <em>special form</em> that takes arbitrarily many arguments and
evaluates to true if <em>all</em> of its arguments are true.  It should only
evaluate the arguments it needs to evaluate to determine the result of the
expression.  For example, <code>(and (&gt; 3 2) (&lt; 7 8) #f)</code> should
evaluate to false.</li>
<li><code>or</code> should be a <em>special form</em> that takes arbitrarily many arguments and
evaluates to true if <em>any</em> of its arguments is true.  It should only evaluate
the arguments it needs to evaluate to determine the result of the expression.
For example, <code>(or (&gt; 3 2) #t (&lt; 4 3))</code> should evaluate to true.</li>
<li><code>not</code> should be a <em>built-in function</em> that takes a single argument and should evaluate
to false if its argument is true and true if its argument is false.  For
example, <code>(not (equal? 2 3))</code> should evaluate to true.  If <code>not</code> receives more than one argument,
it should raise a <code>SchemeEvaluationError</code>.</li>
</ul>
<p>In Scheme (as in Python), <code>and</code> and <code>or</code> do not behave like functions, in the
sense that they do not necessarily evaluate all their arguments; they only
evaluate as far as they need to to figure out what their results should be
(this kind of behavior is often referred to as "short circuiting").</p>
<div class="question"><b>Check Yourself:</b><p><p><code>and</code> evaluates to true only if all of its arguments are true.  So if we're
evaluating all its arguments in order one-by-one, under what condition can we
stop (and avoid evaluating the rest of the arguments)?  What about <code>or</code>?
</p></p><p><span id="queue_checkyourself_2"></span></p></div>
<div class="question"><b>Check Yourself:</b><p><p>It could be nice to implement the comparison operations as special forms, too,
so that they can short-circuit as well.  If you want to do that, go ahead!  But
the test cases should pass either way.
</p></p><p><span id="queue_checkyourself_3"></span></p></div>
<p>After implementing these functions / special forms, modify your <code>evaluate</code>
function so that it properly handles the <code>if</code> special form.  Once you have done
so, your code should pass the tests related to conditionals in <code>test.py</code>.</p>
<p>With this addition, your interpreter should be able to handle recursion!  Try
running the following pieces of code from your REPL to check that this is
working:</p>
<pre><code class="nohighlight">in&gt; (define (fib n) (if (&lt;= n 1) n (+ (fib (- n 1)) (fib (- n 2)))))
in&gt; (fib 6)
</code></pre>
<p><a class="anchor" name="catsoop_section_4_2"></a><a class="anchor" name="_example_programs"></a><h3 class="cs_section_title">4.2) Example Programs<a class="cs_permalink" href="#_example_programs">Â§</a></h3></p>
<p>Now is a good time for you to try your hand at writing a couple of small
programs in Scheme itself (after all, an interpreter isn't much use without
some programs to run!).  In the boxes below, we'll check your code using our
interpreter, but you should feel free to run some tests in your own interpreter
as well!</p>
<p><a class="anchor" name="catsoop_section_4_2_1"></a><a class="anchor" name="_absolute_value"></a><h4 class="cs_section_title">4.2.1) Absolute Value<a class="cs_permalink" href="#_absolute_value">Â§</a></h4></p>
<p>In the box below, enter a definition for the <code>abs</code> function,
which takes a number <span class="cs_math_to_render">n</span> as input and returns <span class="cs_math_to_render">|n|</span>.</p>
<p>Note that, unlike your REPL, this box (and the others like it on this page)
<em>do</em> accept multiline expressions (you don't need to write everything on one
line, although you are welcome to if you want).</p>
<p>
<!--START question snekcode0 --><section aria-label="Question">
<div class="question question-mybigbox" id="cs_qdiv_snekcode0" style="position: static">
<div id="snekcode0_rendered_question">
<div id="catsoop_preamble_snekcode0"></div>
<div id="catsoop_prompt_snekcode0" style="display: inline;">Enter your definition below:<br/></div><textarea cols="60" id="snekcode0" name="snekcode0" rows="10">(define (abs n)

)</textarea><br/>
</div><div>
<span id="snekcode0_buttons"></span>
<span id="snekcode0_loading_wrapper" role="status">
<span id="snekcode0_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="snekcode0_score_display" role="status"></span>
<div class="nsubmits_left" id="snekcode0_nsubmits_left" role="status"></div></div>
<div id="snekcode0_solution_container">
<div id="snekcode0_solution">
</div>
<div id="snekcode0_solution_explanation">
</div>
</div>
<div aria-atomic="true" id="snekcode0_message" role="status"></div>
</div>
</section>
<!--END question snekcode0 -->
</p>
<p><a class="anchor" name="catsoop_section_4_2_2"></a><a class="anchor" name="_factorial"></a><h4 class="cs_section_title">4.2.2) Factorial<a class="cs_permalink" href="#_factorial">Â§</a></h4></p>
<p>In the box below, enter a definition for the <code>factorial</code> function,
which takes a nonnegative integer <span class="cs_math_to_render">n</span> as input and returns <span class="cs_math_to_render">n!</span>.</p>
<p>We'll test your code using our Scheme interpreter behind the scenes, but you
can/should also feel free to test it on your own implementation!</p>
<p>
<!--START question snekcode1 --><section aria-label="Question">
<div class="question question-mybigbox" id="cs_qdiv_snekcode1" style="position: static">
<div id="snekcode1_rendered_question">
<div id="catsoop_preamble_snekcode1"></div>
<div id="catsoop_prompt_snekcode1" style="display: inline;">Enter your definition below:<br/></div><textarea cols="60" id="snekcode1" name="snekcode1" rows="10">(define (factorial n)

)</textarea><br/>
</div><div>
<span id="snekcode1_buttons"></span>
<span id="snekcode1_loading_wrapper" role="status">
<span id="snekcode1_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="snekcode1_score_display" role="status"></span>
<div class="nsubmits_left" id="snekcode1_nsubmits_left" role="status"></div></div>
<div id="snekcode1_solution_container">
<div id="snekcode1_solution">
</div>
<div id="snekcode1_solution_explanation">
</div>
</div>
<div aria-atomic="true" id="snekcode1_message" role="status"></div>
</div>
</section>
<!--END question snekcode1 -->
</p>
<p><a class="anchor" name="catsoop_section_5"></a><a class="anchor" name="_lists"></a><h2 class="cs_section_title">5) Lists<a class="cs_permalink" href="#_lists">Â§</a></h2></p>
<p>Next, we'll add support for <em>lists</em> (after all, despite the joke acronyms in the
last lab, the name LISP is <em>actually</em> short for <strong>LIS</strong>t <strong>P</strong>rocessor, so
we're not really done until we've got support for
lists!).  In Scheme, we will implement lists as <a href="https://en.wikipedia.org/wiki/Linked_list" target="_blank">linked lists</a> (as is typical for LISP).
While the high-level view will be the same as the linked lists
we saw in recitations, the details here will be slightly different.  The
implementation is discussed in detail below.</p>
<p><a class="anchor" name="catsoop_section_5_1"></a><a class="anchor" name="_pairs"></a><h3 class="cs_section_title">5.1) Pairs<a class="cs_permalink" href="#_pairs">Â§</a></h3></p>
<p>We'll start by implementing a built-in function called <a href="https://en.wikipedia.org/wiki/Cons"><code>cons</code></a>.  <code>cons</code>, so called
because it <strong>cons</strong>tructs new objects, is used to make ordered pairs, often
referred to as "cons cells."  Each cons cell consists of 2 values, which, for
<a href="https://en.wikipedia.org/wiki/CAR_and_CDR">historical reasons</a>, are referred
to as the <code>car</code> and the <code>cdr</code> (pronounced "could-er"), respectively.</p>
<p>You should start by implementing a class called <code>Pair</code> to represent a cons cell.
Each instance of <code>Pair</code> should have <strong><em>exactly two</em> instance variables</strong>:</p>
<ul>
<li>an attribute called <code>car</code> (which represents the first element in the pair), and</li>
<li>an attribute called <code>cdr</code> (which represents the second element in the pair).</li>
</ul>
<p>You should also add support for the <code>cons</code> function to your interpreter.  For
example, calling <code>(cons 1 2)</code> should result in a new <code>Pair</code> object whose <code>car</code>
is <code>1</code> and whose <code>cdr</code> is <code>2</code>.</p>
<p>If <code>cons</code> is called with the wrong number of arguments, it should raise a
<code>SchemeEvaluationError</code>.</p>
<p><a class="anchor" name="catsoop_section_5_1_1"></a><a class="anchor" name="_car_and_cdr"></a><h4 class="cs_section_title">5.1.1) <code>car</code> and <code>cdr</code><a class="cs_permalink" href="#_car_and_cdr">Â§</a></h4></p>
<p>In addition, implement two new built-in functions to retrieve the <code>car</code> and <code>cdr</code>,
respectively, from a given cons cell.</p>
<ul>
<li><code>(car X)</code> should take a cons cell (an instance of your <code>Pair</code> class) as argument and should return the first element in the pair.  If it is called on something that is not a cons cell, or if it is provided the wrong number of arguments, it should raise a <code>SchemeEvaluationError</code>.</li>
<li><code>(cdr X)</code> should take a cons cell as argument and return the second element in the pair.  If it is called on something that is not a cons cell, or if it is provided the wrong number of arguments, it should raise a <code>SchemeEvaluationError</code>.</li>
</ul>
<p><a class="anchor" name="catsoop_section_5_2"></a><a class="anchor" name="_lists_2"></a><h3 class="cs_section_title">5.2) Lists<a class="cs_permalink" href="#_lists_2">Â§</a></h3></p>
<p>It may seem simple, but <code>cons</code> is a powerful tool.  Among other things, <code>cons</code>
can be used to implement <em>linked lists</em>.  In this section, we'll add support
for linked lists to our interpreter.</p>
<p><a class="anchor" name="catsoop_section_5_2_1"></a><a class="anchor" name="_and_empty_lists"></a><h4 class="cs_section_title">5.2.1) <code>()</code> and Empty Lists<a class="cs_permalink" href="#_and_empty_lists">Â§</a></h4></p>
<p>In Scheme, a special value <code>()</code> (which is roughly equivalent to Python's
<code>None</code>) is used to represent empty lists, and we will use that same convention
for our interpreter.</p>
<p>Add support for <code>()</code> to your interpreter, so that evaluating <code>()</code>
produces some internal representation for the empty list.</p>
<p>For purposes of passing our test suite, the following things are important:</p>
<ul>
<li>Evaluating <code>()</code> multiple times should always produce results that are equivalent to each other when comparing with Python's <code>==</code>.</li>
<li>Evaluating <code>()</code> must produce a value that is distinct from <code>#f</code> and <code>0</code> (i.e., that is not equivalent to those things when comparing with <code>==</code>).</li>
<li><code>()</code> should not be an instance of <code>Pair</code> (since it does not have a <code>car</code> or a <code>cdr</code>).</li>
</ul>
<p><a class="anchor" name="catsoop_section_5_2_2"></a><a class="anchor" name="_linked_lists"></a><h4 class="cs_section_title">5.2.2) Linked Lists<a class="cs_permalink" href="#_linked_lists">Â§</a></h4></p>
<p>In most dialects of LISP, lists are implemented using cons cells.  In particular, a list is either:</p>
<ul>
<li>an empty list (represented by <code>()</code>), or</li>
<li>a cons cell whose <code>car</code> is the first element in the list and whose <code>cdr</code> is a list containing the rest of the elements.</li>
</ul>
<p>This forms the basis of a simple linked-list structure whose contents can be
manipulated with <code>cons</code>, <code>car</code>, and <code>cdr</code>. Note that <code>()</code> is the only list
that is not also a cons cell.</p>
<p>For example, consider the following examples:</p>
<ul>
<li><code>()</code> represents the empty list.</li>
<li><code>(cons 9 ())</code> represents a list with a single element (<code>9</code>).</li>
<li><code>(cons 9 (cons 8 (cons 7 ())))</code> represents a list containing the elements <code>9</code>, <code>8</code>, and <code>7</code>, in that order.</li>
</ul>
<p>It's worth noting that, although lists are comprised of cons cells, not all
cons cells are lists (for example, <code>(cons 1 2)</code> is not a list).</p>
<p><a class="anchor" name="catsoop_section_5_3"></a><a class="anchor" name="_built_in_list_functions"></a><h3 class="cs_section_title">5.3) Built-in List Functions<a class="cs_permalink" href="#_built_in_list_functions">Â§</a></h3></p>
<p>In order to make using lists practical, we'll add support for more built-in
functions designed to operate on lists.</p>
<p>To start, we'll add an easier way to create lists.  It's kind of a pain to
write a big chain of <code>cons</code> calls to create a new list.  So we'll add support
for the <code>list</code> function.  This function should take zero or more arguments and
should construct a linked list that contains those arguments, in order.  You
should make sure that calling <code>list</code> with no arguments produces our
representation for an empty list.</p>
<p>For example:</p>
<ul>
<li><code>(list)</code> should evaluate to the same thing as <code>()</code></li>
<li><code>(list 1)</code> should evaluate to the same thing as <code>(cons 1 ())</code></li>
<li><code>(list 1 2)</code> should evaluate to the same thing as <code>(cons 1 (cons 2 ()))</code></li>
<li>and so on.</li>
</ul>
<p>In addition, we will define some additional built-in functions for operating on
lists within Scheme.</p>
<div class="question">
<p><strong>All of the functions below should be implemented by operating directly on
instances of <code>Pair</code> representing linked lists, without ever converting to or
using a Python list/tuple.</strong>
</p></div>
<h4>Convenience Methods</h4>
<p>Start by adding a few new built-in functions that that operate on lists:</p>
<ul>
<li><code>(list? OBJECT)</code> should take an arbitrary object as input, and it should return <code>#t</code> if that object is a linked list, and <code>#f</code> otherwise.</li>
<li><code>(length LIST)</code> should take a list as argument and should return the length of that list.  When called on any object that is not a linked list, it should raise a <code>SchemeEvaluationError</code>.</li>
<li><code>(list-ref CONS INDEX)</code> should take a cons cell and a nonnegative index, and it should return the element at the given index in the given cons cell. As in Python, indices start from 0. If the item at the desired index is not in the car of a Pair object, you should raise a <code>SchemeEvaluationError</code>. You do not need to support negative indices. For example, <code>(list-ref (cons 5 4) 0)</code> should return 5 but <code>(list-ref (cons 5 4) 1)</code> should raise a <code>SchemeEvaluationError</code>. However, <code>(list-ref (list 5 4) 1)</code> should return 4.</li>
<li><code>(append LIST1 LIST2 LIST3 ...)</code> should take an arbitrary number of lists as arguments and should return a new list representing the concatenation of these lists.  If exactly one list is passed in, it should return a shallow copy of that list.  If <code>append</code> is called with no arguments, it should produce an empty list.  Calling <code>append</code> on any elements that are not lists should result in a <code>SchemeEvaluationError</code>.  Note that this <code>append</code> is different from Python's, in that this <strong>should not mutate any of its arguments</strong>.</li>
</ul>
<h4>Implementation</h4>
<p>Implement the <code>list</code>, <code>car</code>, <code>cdr</code>, <code>length</code>, <code>list-ref</code>, and <code>append</code>
functions and add them to the built-in functions.  Once you have done so, your
code should pass the test cases related to lists in <code>test.py</code>.  <strong>REMINDER that
these functions should not operate by converting to Python lists/tuples.</strong></p>
<p><a class="anchor" name="catsoop_section_5_4"></a><a class="anchor" name="_example_programs_2"></a><h3 class="cs_section_title">5.4) Example Programs<a class="cs_permalink" href="#_example_programs_2">Â§</a></h3></p>
<p>Now that we have lists available to us, it's again a good time to try your hand
at writing some more Scheme code involving lists!  Again, we'll write a
couple of functions. (In the two functions below, assume that you do not
have <code>map</code>, <code>filter</code>, or <code>reduce</code> -- instead, think of direct recursive
implementations.)</p>
<p><a class="anchor" name="catsoop_section_5_4_1"></a><a class="anchor" name="_home_on_the_range"></a><h4 class="cs_section_title">5.4.1) Home on the Range<a class="cs_permalink" href="#_home_on_the_range">Â§</a></h4></p>
<p>First, let's implement a function to replicate the behavior of <code>range</code> in
Python.  In particular, define a function <code>(range start stop step)</code>, which
outputs a list containing the same numbers that would exist in Python's
<code>range(start, stop, step)</code>.</p>
<p>Importantly, unlike Python's <code>range</code>, you only need to handle the case of a
positive <code>step</code> argument, and you can always assume that all three arguments
will be provided.</p>
<p>
<!--START question snekcode3 --><section aria-label="Question">
<div class="question question-mybigbox" id="cs_qdiv_snekcode3" style="position: static">
<div id="snekcode3_rendered_question">
<div id="catsoop_preamble_snekcode3"></div>
<div id="catsoop_prompt_snekcode3" style="display: inline;">Enter your definition below:<br/></div><textarea cols="60" id="snekcode3" name="snekcode3" rows="10">(define (range start stop step)

)</textarea><br/>
</div><div>
<span id="snekcode3_buttons"></span>
<span id="snekcode3_loading_wrapper" role="status">
<span id="snekcode3_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="snekcode3_score_display" role="status"></span>
<div class="nsubmits_left" id="snekcode3_nsubmits_left" role="status"></div></div>
<div id="snekcode3_solution_container">
<div id="snekcode3_solution">
</div>
<div id="snekcode3_solution_explanation">
</div>
</div>
<div aria-atomic="true" id="snekcode3_message" role="status"></div>
</div>
</section>
<!--END question snekcode3 -->
</p>
<p><a class="anchor" name="catsoop_section_5_4_2"></a><a class="anchor" name="_flatten_list"></a><h4 class="cs_section_title">5.4.2) Flatten List<a class="cs_permalink" href="#_flatten_list">Â§</a></h4></p>
<p>Now, let's implement a function we've written a few times in Python this
semester: a function that "flattens" a given list.  Given a list that contains
elements, some of which are lists (which could themselves contain other lists,
etc.), the <code>flat</code> function should return a single "flat" list, containing all of
the elements from the original function but with all nesting of lists removed.</p>
<p>
<!--START question snekcode2 --><section aria-label="Question">
<div class="question question-mybigbox" id="cs_qdiv_snekcode2" style="position: static">
<div id="snekcode2_rendered_question">
<div id="catsoop_preamble_snekcode2"></div>
<div id="catsoop_prompt_snekcode2" style="display: inline;">Enter your definition below:<br/></div><textarea cols="60" id="snekcode2" name="snekcode2" rows="10">(define (flat L)

)</textarea><br/>
</div><div>
<span id="snekcode2_buttons"></span>
<span id="snekcode2_loading_wrapper" role="status">
<span id="snekcode2_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="snekcode2_score_display" role="status"></span>
<div class="nsubmits_left" id="snekcode2_nsubmits_left" role="status"></div></div>
<div id="snekcode2_solution_container">
<div id="snekcode2_solution">
</div>
<div id="snekcode2_solution_explanation">
</div>
</div>
<div aria-atomic="true" id="snekcode2_message" role="status"></div>
</div>
</section>
<!--END question snekcode2 -->
</p>
<p><a class="anchor" name="catsoop_section_6"></a><a class="anchor" name="_evaluating_multiple_expressions"></a><h2 class="cs_section_title">6) Evaluating Multiple Expressions<a class="cs_permalink" href="#_evaluating_multiple_expressions">Â§</a></h2></p>
<p>To help with the above, introduce a new built-in function called <code>begin</code>.
<code>begin</code> should simply return its last argument.  This is a useful structure for
running commands successively: even though only the last argument is returned,
all of the arguments are evaluated in turn, which allows us to run arbitrary
expressions sequentially.</p>
<p>For example, <code>(begin (define x 7) (define y 8) (- x y))</code> should evaluate to <code>-1</code>.</p>
<p>After implementing <code>begin</code>, your code should pass <code>test_begin</code> (but not
necessarily <code>test_begin2</code>, which depends on other pieces from later in the lab).</p>
<p><a class="anchor" name="catsoop_section_7"></a><a class="anchor" name="_reading_from_files"></a><h2 class="cs_section_title">7) Reading From Files<a class="cs_permalink" href="#_reading_from_files">Â§</a></h2></p>
<p>OK, now that we have lists, conditionals, and
<code>begin</code>, we've got some <em>real</em> power.  But it's kind of a pain to write even
medium-sized programs with this infrastructure, since we are limited to
evaluating one expression at a time via the REPL (and, even though our
interpreter supports multiline expressions, our REPL does not!).</p>
<p>In this section, we will get rid of this limitation by adding the capability to
run the contents of a file before dropping into our REPL, which we can use, for
example, to define multiple functions.</p>
<p>Define a function called <code>evaluate_file</code> in <code>lab.py</code>.  This function should
take a single argument (a string containing the name of a file to be evaluated)
and an optional argument (the frame in which to evaluate the expression),
and it should return the result of evaluating the expression contained in the
file (you may assume that each file contains a single expression).</p>
<p>You may find the documentation for Python's built-in <a href="https://docs.python.org/3/library/functions.html#open"><code>open</code> function</a> helpful.</p>
<p>At this point, your code should pass the tests  <code>test_file</code> and <code>test_file2</code> in <code>test.py</code>.
The other file tests rely on working functionality in later parts of the lab!</p>
<p><a class="anchor" name="catsoop_section_8"></a><a class="anchor" name="_command_line_arguments"></a><h2 class="cs_section_title">8) Command-Line Arguments<a class="cs_permalink" href="#_command_line_arguments">Â§</a></h2></p>
<p>Now that we have the ability to evaluate the contents of a file in a particular
frame, we will need to let Python know <em>which</em> files it should evaluate
before dropping into the REPL.  We will do this by passing the names of these
files to Scheme as <em>command-line arguments</em>.  For example, instead of just
running:</p>
<pre><code class="nohighlight">$ python3 lab.py
</code></pre>
<p>we will run something like:</p>
<pre><code class="nohighlight">$ python3 lab.py some_definitions.scm more_definitions.scm
</code></pre>
<p>From inside of Python, these arguments are available as part of the <code>sys.argv</code>
list (note that, if you haven't already, you should add <code>import sys</code> near the
top of your file at this point).  For the example above, <code>sys.argv</code> will
contain:</p>
<pre><code class="nohighlight">['lab.py', 'some_definitions.scm', 'more_definitions.scm']
</code></pre>
<p>Modify <code>lab.py</code> so that, when <code>lab.py</code> is run with filenames passed in on the
command line, it evaluates the expressions contained in those files into the
initial frame before entering the REPL.  Note that you can provide the REPL
with a specific frame to use as its frame by passing in a frame as the
<code>repl_frame</code> argument, for example:</p>
<pre><code class="language-py">SchemeREPL(..., repl_frame=my_frame, ...)
</code></pre>
<p>You may assume that each file contains only one expression.  To test your code,
you can make a few files that contain simple expressions you can check (for
example, define a single variable inside a file and make sure it is available
to you from the REPL after that file is evaluated).</p>
<p>After you have implemented <code>begin</code> and command-line arguments, you should be
able to run <code>python3 lab.py test_files/definitions.scm</code> to grab some
definitions into the REPL.</p>
<p><a class="anchor" name="catsoop_section_9"></a><a class="anchor" name="_map_filter_and_reduce"></a><h2 class="cs_section_title">9) Map, Filter, and Reduce<a class="cs_permalink" href="#_map_filter_and_reduce">Â§</a></h2></p>
<p>Beyond the linked-list-related functions we defined above, we'll now implement a few additional functions
in Scheme that will allow us to easily construct new lists from existing ones:</p>
<ul>
<li>
<p><code>(map FUNCTION LIST)</code> takes a function and a list as arguments, and it returns a <em>new list</em> containing the results of applying the given function to each element of the given list.
For example, <code>(map (lambda (x) (* 2 x)) (list 1 2 3))</code> should produce the list containing <code>2</code>, <code>4</code>, and <code>6</code> (in that order).</p>
</li>
<li>
<p><code>(filter FUNCTION LIST)</code> takes a function and a list as arguments, and it returns a <em>new list</em> containing only the elements of the given list for which the given function returns true.</p>
<p>For example, <code>(filter (lambda (x) (&gt; x 0)) (list -1 2 -3 4))</code> should produce the list containing <code>2</code> and <code>4</code>.</p>
</li>
<li>
<p><code>(reduce FUNCTION LIST INITVAL)</code> takes a function, a list, and an initial value as inputs.  It produces its output by successively applying the given function to the elements in the list, maintaining an intermediate result along the way.  This is perhaps the most difficult of the three functions to understand, but it may be easiest to see by example.</p>
<p>Consider <code>(reduce * (list 9 8 7) 1)</code>.  The function in question is <code>*</code>.  Our initial value is <code>1</code>.  We take this value and combine it with the first element in the list using the given function, giving us <code>(* 1 9)</code> or <code>9</code>.  Then we take <em>this</em> result and combine it with the next element in the list using the given function, giving us <code>(* 9 8)</code> or <code>72</code>.  Then we take <em>this</em> result and combine it with the next element in the list using the given function, giving us <code>(* 72 7)</code> or <code>504</code>.  Since we have reached the end of the list, this is our final return value (if there were more elements in the list, we would keep combining our "result so far" with the next element in the list, using the given function).</p>
</li>
</ul>
<p>The Wikipedia pages for <a href="https://en.wikipedia.org/wiki/Map_%28higher-order_function%29">map</a>, <a href="https://en.wikipedia.org/wiki/Filter_%28higher-order_function%29">filter</a>, and <a href="https://en.wikipedia.org/wiki/Fold_%28higher-order_function%29">reduce</a> provide some additional examples.</p>
<p>Once we have these three functions, we have the equivalent of list comprehensions in Scheme!  In Python, for example, we might write:</p>
<pre><code class="nohighlight">sum([i**2 for i in some_list if i &lt; 0])
</code></pre>
<p>In Scheme, we can now do the same thing with the following code:</p>
<pre><code class="nohighlight">(reduce + (map (lambda (i) (* i i)) (filter (lambda (i) (&lt; i 0)) some_list)) 0)
</code></pre>
<p>This is a lot to take in, but it gives us the same result:</p>
<ul>
<li>It first <em>filters</em> <code>some_list</code> to produce a list containing only the negative values.</li>
<li>It then <em>maps</em> the <code>square</code> function onto the resulting list.</li>
<li>Finally, it <em>reduces</em> that result by successive application of the <code>+</code> operator to produce the sum.</li>
</ul>
<p><a class="anchor" name="catsoop_section_9_1"></a><a class="anchor" name="_implementation"></a><h3 class="cs_section_title">9.1) Implementation<a class="cs_permalink" href="#_implementation">Â§</a></h3></p>
<p>We'll tackle implementing <code>map</code>, <code>filter</code>, and <code>reduce</code> in a different way than
the other functions we've written so far: by defining them in Scheme itself.
Inside of the <code>test_files</code> directory, create a file called
<code>map_filter_reduce.scm</code>, and use that file to define <code>map</code>, <code>filter</code>, <code>reduce</code>,
and any helper functions you wish.</p>
<p>With those functions defined in that file, your code should pass the test cases
for <code>map</code>, <code>filter</code>, and <code>reduce</code> in <code>test.py</code>.  You can also test these
functions in your REPL by specifying that file as an argument at the command
line as follows:</p>
<pre><code class="nohighlight">python lab.py test_files/map_filter_reduce.scm
</code></pre>
<p>
<!--START question mapfilterreduce --><section aria-label="Question">
<div class="question question-fileupload" id="cs_qdiv_mapfilterreduce" style="position: static">
<div id="mapfilterreduce_rendered_question">
<div id="catsoop_preamble_mapfilterreduce"></div>
<div id="catsoop_prompt_mapfilterreduce" style="display: inline;">To make the test cases work online, upload your
<code>map_filter_reduce.scm</code> file below.  Note that this box will not check your
uploaded file for correctness; it will just make your code available during the
code submission process.<br/></div><input aria-labelledby="catsoop_prompt_mapfilterreduce" id="mapfilterreduce" name="mapfilterreduce" style="display: none" type="file"/><button class="btn btn-catsoop" id="mapfilterreduce_select_button">Select File</button>Â <tt><span id="mapfilterreduce_selected_file">No file selected</span></tt><script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
document.getElementById('mapfilterreduce_select_button').addEventListener('click', function (){
    document.getElementById("mapfilterreduce").click();
});
document.getElementById('mapfilterreduce').onchange = function (){
    document.getElementById('mapfilterreduce_selected_file').innerText = document.getElementById('mapfilterreduce').value;
};
dnd_mapfilterreduce = document.getElementById('cs_qdiv_mapfilterreduce');
dnd_mapfilterreduce.ondragover = dnd_mapfilterreduce.ondragenter = function(e){e.preventDefault();};
dnd_mapfilterreduce.ondrop = function(e){
    document.getElementById("mapfilterreduce").files = e.dataTransfer.files;
    document.getElementById('mapfilterreduce').onchange();
    e.preventDefault();
};
// @license-end</script>
</div><div>
<span id="mapfilterreduce_buttons"></span>
<span id="mapfilterreduce_loading_wrapper" role="status">
<span id="mapfilterreduce_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="mapfilterreduce_score_display" role="status"></span>
<div class="nsubmits_left" id="mapfilterreduce_nsubmits_left" role="status"></div></div>
<div id="mapfilterreduce_solution_container">
<div id="mapfilterreduce_solution">
</div>
<div id="mapfilterreduce_solution_explanation">
</div>
</div>
<div aria-atomic="true" id="mapfilterreduce_message" role="status"></div>
</div>
</section>
<!--END question mapfilterreduce -->
</p>
<p><a class="anchor" name="catsoop_section_10"></a><a class="anchor" name="_variable_binding_manipulation"></a><h2 class="cs_section_title">10) Variable-Binding Manipulation<a class="cs_permalink" href="#_variable_binding_manipulation">Â§</a></h2></p>
<p>We will finish by implementing a couple of additional special forms, which can
be used to manipulate variable bindings: <code>del</code>, <code>let</code> and <code>set!</code>.</p>
<p>With these pieces implemented, we will have the ability to use
object-oriented programming from within Scheme.</p>
<p><a class="anchor" name="catsoop_section_10_1"></a><a class="anchor" name="_del"></a><h3 class="cs_section_title">10.1) <code>del</code><a class="cs_permalink" href="#_del">Â§</a></h3></p>
<p><code>del</code> is used for deleting variable bindings within the current frame.
It takes the form: <code>(del VAR)</code>, where <code>VAR</code> is a variable name.  If the given
variable is bound in the current frame, its binding should be removed, and
the associated value should be returned.  If <code>VAR</code> is not bound locally, this
special form should raise a <code>SchemeNameError</code>.</p>
<p>Note that implementing this behavior correctly requires that your frames
are structured as described in <a href="https://py.mit.edu/spring25/labs/lisp_1#_frames_initial_structure">section 6.4.2 of Lab
11</a>, i.e. that the built-ins
are in a separate frame that is the parent of the initial frame.</p>
<p><a class="anchor" name="catsoop_section_10_2"></a><a class="anchor" name="_let"></a><h3 class="cs_section_title">10.2) <code>let</code><a class="cs_permalink" href="#_let">Â§</a></h3></p>
<p><code>let</code> is used for creating <em>local variable definitions</em>.  It takes the form:
<code>(let ((VAR1 VAL1) (VAR2 VAL2) (VAR3 VAL3) ...) BODY)</code>, where <code>VAR1</code>, <code>VAR2</code>,
etc., are variable names, and <code>VAL1</code>, <code>VAL2</code>, etc., are expressions denoting
the values to which those names should be bound.  It works by:</p>
<ul>
<li>Evaluating all the given values in the current frame.</li>
<li><em>Creating a new frame</em> whose parent is the current frame, binding each name to its associated value in this new frame.</li>
<li>Evaluating the <code>BODY</code> expression in this new frame (this value is the result of evaluating the <code>let</code> special form).</li>
</ul>
<p>Note that the given bindings are only available in the body of the <code>let</code> expression.  For example:</p>
<pre><code class="nohighlight">in&gt; (define z 5)
    out&gt; 5

in&gt; (let ((x 5) (y 3)) (+ x y z))
    out&gt; 13

in&gt; x
    EXCEPTION!

in&gt; y
    EXCEPTION!

in&gt; z
    out&gt; 5
</code></pre>
<p><a class="anchor" name="catsoop_section_10_3"></a><a class="anchor" name="_set"></a><h3 class="cs_section_title">10.3) <code>set!</code><a class="cs_permalink" href="#_set">Â§</a></h3></p>
<p><code>set!</code> (pronounced "set bang") is used for <em>changing the
value of an existing variable</em>.  It takes the form: <code>(set! VAR EXPR)</code>, where
<code>VAR</code> is a variable name, and <code>EXPR</code> is an expression.</p>
<p>It should work by:</p>
<ul>
<li>Evaluating the given expression in the current frame</li>
<li>Finding the nearest enclosing frame in which <code>VAR</code> is defined (starting from the current frame and working upward until it finds a binding) and updating its binding <em>in that frame</em> to be the result of evaluating <code>EXPR</code></li>
</ul>
<p>It should also evaluate to that same value.</p>
<p>If <code>VAR</code> is not defined in any frames in the chain, <code>set!</code> should raise
a <code>SchemeNameError</code>.</p>
<pre><code class="nohighlight">in&gt; (define x 7)
    out&gt; 7

in&gt; (define (foo z) (set! x (+ z 2)))
    out&gt; function object

in&gt; (foo 3)
    out&gt; 5

in&gt; x
    out&gt; 5

in&gt; (define (bar z) (define x (+ z 2)))
    out&gt; function object

in&gt; (bar 7)
    out&gt; 9

in&gt; x
    out&gt; 5
</code></pre>
<p>Implement <code>let</code> and <code>set!</code> in <code>lab.py</code>.  After doing so, your code should pass
all the tests in <code>test.py</code>!  Note that the last 6 test cases are realistic
programs implemented in Scheme (including implementations of N-D Minesweeper and
a Sudoku solver)!  The code for the N-D Minesweeper implementation and the
Sudoku solver are also available in the <code>test_files</code> directory in a format that
makes them a little easier to read, in case you want to look at them, try them
in your REPL, or modify them.  You can also try running them through a more
fully featured Scheme interpreter; among others, they should work in <a href="https://www.gnu.org/software/mit-scheme/">MIT/GNU Scheme</a>, <a href="https://call-cc.org/">Chicken Scheme</a>, or <a href="https://www.gnu.org/software/guile/">Guile Scheme</a>.</p>
<p><a class="anchor" name="catsoop_section_11"></a><a class="anchor" name="_endnotes_and_commentary"></a><h2 class="cs_section_title">11) Endnotes and Commentary<a class="cs_permalink" href="#_endnotes_and_commentary">Â§</a></h2></p>
<p>Congratulations; you've just implemented your first interpreter!  By now your Scheme interpreter is capable of evaluating arbitrarily complicated programs!</p>
<p>Hopefully this has been fun, interesting, and educational in its own right, but there are a few important reasons why we've chosen this as a project:</p>
<ol>
<li>
<p>There is something powerful in understanding that an interpreter for a programming language (even one as complicated as Python) is <em>just another computer program</em>, and it is something that, with time and effort, you are capable of writing.</p>
</li>
<li>
<p>This is an example of a rather large and complicated program, but we were able to manage that complexity by breaking things down into small pieces.</p>
</li>
<li>
<p>We wanted to give you an opportunity to make some more open-ended design decisions than you have been asked to make in the past, and this lab offers such an opportunity.</p>
</li>
<li>
<p>Our little Scheme interpreter actually has a lot in common with the Python interpreter, and so there is a hope that you have learned something not only about this little language but also about how Python behaves.  Among other things:</p>
<ul>
<li>both run programs by breaking the process down into lexing, parsing, and evaluating, and</li>
<li>the way function calls are scoped and handled is very similar in the two languages.</li>
</ul>
</li>
<li>
<p>Course 6 and LISP have a long history:</p>
<ul>
<li>LISP was conceived by John McCarthy at MIT in 1958, and one of the most widely used LISP dialects, Scheme, was developed here by Guy Steele and Jerry Sussman in the 1970s.</li>
<li>The predecessor to 6.101, 6.001 <em>Structure and Interpretation of Computer Programs</em>, was taught as part of the course 6 introductory series for around 30 years and used Scheme as its primary language.  The <a href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/index.html">associated textbook</a> is still considered by many to be one of the best books ever written about computer programming.</li>
</ul>
</li>
</ol>
<p>Now that we have a working interpreter, <a href="#_optional_improvements_and_extensions">section 13</a> includes a few suggestions of neat (but optional) additional features that you might consider adding to your interpreter.  Although these are not required, they would make great extra practice if you're looking for it!</p>
<p><a class="anchor" name="catsoop_section_12"></a><a class="anchor" name="_code_submission"></a><h2 class="cs_section_title">12) Code Submission<a class="cs_permalink" href="#_code_submission">Â§</a></h2></p>
<p>When you have tested your code sufficiently on your own machine, submit your
modified <code>lab.py</code> using the <code>6.101-submit</code> script.  If you haven't already
installed it, see the instructions on <a href="https://py.mit.edu/spring25/info/infrastructure">this page</a>.</p>
<p>The following command should submit the lab, assuming that the last argument
<code>/path/to/lab.py</code> is replaced by the location of your <code>lab.py</code> file:</p>
<pre><code class="language-nohighlight">$ 6.101-submit -a lisp_2 /path/to/lab.py
</code></pre>
<p>Running that script should submit your file to be checked.  After submitting your file, information about the checking process can be found below:</p>
<p>
<!--START question code_submit --><section aria-label="Question">
<div class="question question-lab101_vprof" id="cs_qdiv_code_submit" style="position: static">
<div id="code_submit_rendered_question">
<div id="catsoop_preamble_code_submit"></div>
<div id="catsoop_prompt_code_submit" style="display: inline;"></div>When this page was loaded, you had not yet made any submissions.<br/>If you make a submission, results should show up here automatically; or you may click <a href="javascript:reload_code_submit();">here</a> or reload the page to see updated results.<br/>
</div><div>
<span id="code_submit_buttons"></span>
<span id="code_submit_loading_wrapper" role="status">
<span id="code_submit_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="code_submit_score_display" role="status"></span>
<div class="nsubmits_left" id="code_submit_nsubmits_left" role="status"></div></div>
<div id="code_submit_solution_container">
<div id="code_submit_solution">
</div>
<div id="code_submit_solution_explanation">
</div>
</div>
<div aria-atomic="true" id="code_submit_message" role="status"></div>
</div>
</section>
<!--END question code_submit -->
</p>
<p><a class="anchor" name="catsoop_section_13"></a><a class="anchor" name="_optional_improvements_and_extensions"></a><h2 class="cs_section_title" id="catsoop_label_optional" label="optional">13) Optional Improvements and Extensions<a class="cs_permalink" href="#_optional_improvements_and_extensions">Â§</a></h2></p>
<p><a class="anchor" name="catsoop_section_13_1"></a><a class="anchor" name="_tail_call_optimization"></a><h3 class="cs_section_title">13.1) Tail-Call Optimization<a class="cs_permalink" href="#_tail_call_optimization">Â§</a></h3></p>
<p>If you have the time and interest, a <em>really</em> interesting and powerful
optimization for our interpreter comes in the form of <em>tail-call optimization</em>.</p>
<p>A typical way of structuring the evaluator from above involves making recursive
calls to <code>evaluate</code>, in particular when calling functions.  This is a nice way
of structuring things, but it actually leads to issues.  For example, try
calling <code>(fib 2000)</code> from your REPL after loading in the definitions from
<code>test_files/definitions.scm</code>.  What happens?</p>
<p>We run into issues with recursive calls because Python (necessarily) has a
limit on the "depth" it will allow in a recursive call, to prevent infinite
recursion.  Even if Python didn't have this limit, it would end up using quite
a lot of memory allocating new stack frames for these recursive calls.</p>
<p>A neat optimization to avoid this problem is to implement <a href="http://stackoverflow.com/questions/310974/what-is-tail-call-optimization#310980" target="_blank">tail-call optimization</a>,
whereby we can avoid some of these issues (allowing, for example, computing
<code>(fib n)</code> for arbitrarily large <code>n</code>).</p>
<p>In short, many pieces of our interpreter involve returning the result of a
single new call to <code>evaluate</code>, with a different expression and a different
frame.  In those situations (conditionals, calling user-defined
functions, etc.), it would be much better from an efficiency perspective to
avoid the recursive call to <code>evaluate</code>; rather, we can simply adjust the values
of the expression and the frame within the same call to <code>evaluate</code> by
introducing a looping structure: keep looping until we have successfully
evaluated a structure, and if the result is simply the result of evaluating
another expression (potentially in a different frame), then adjust those
values as necessary.</p>
<p>There are no tests for this optimization, but after doing so, your code should
work for <code>(fib 10000)</code> (or arbitrarily high <code>n</code>)!</p>
<p><a class="anchor" name="catsoop_section_13_2"></a><a class="anchor" name="_additional_optional_improvements_and_exercises"></a><h3 class="cs_section_title">13.2) Additional (Optional) Improvements and Exercises<a class="cs_permalink" href="#_additional_optional_improvements_and_exercises">Â§</a></h3></p>
<p>If you have the time and interest, you can improve upon this base language by
implementing some additional features.  Below are some ideas for possible
improvements or just for ways to get extra practice.  These are by no means
required, but we are still happy to help with them if you get stuck!</p>
<ul>
<li>If you haven't already done so, add syntax checking for all of the special forms introduced in this lab.</li>
<li>Add support for multiline expressions to your REPL.  If a user enters something that could be a valid start of an expression (but is not a complete expression), you should continue prompting for input until the result forms a valid expression (in which case you should evaluate it) or something that could not be the start of a valid expression (in which case you should report a syntax error).</li>
<li>To support print-statement debugging, add a built-in function <code>display</code>, such that <code>(display EXPR)</code> prints the result of <code>EXPR</code> and then returns it.</li>
<li>Allow the body of a function defined with the <code>lambda</code> special form, or the body of a <code>let</code> expression,  to consist of more than one expression (this should be implicitly translated to a <code>begin</code> expression).</li>
<li>Add a function called <code>set-car!</code> that changes the first element of a cons cell to a particular value.  Then use your list built-ins to implement a <code>set-list-ref</code> function in Scheme.</li>
<li>Add support for the <code>quote</code> and <code>eval</code> special forms.  <code>(quote EXPR)</code> should return the given expression <em>without evaluating it</em>.  Passing such an expression into <code>eval</code> should that evaluate it.  For example, running <code>(eval (quote a))</code> should give the same result as evaluating <code>a</code>.</li>
<li>Implement strings as an additional data type (be careful of how you handle comments to make sure that a <code>;</code> within a string doesn't get treated as the start of a comment!).</li>
<li>Improve the system's error reporting by providing meaningful error messages that describe what error occurred.</li>
<li>Since <em>iteration</em> doesn't exist in Scheme (except via recursion), try implementing some simple programs in Scheme for extra practice with recursion!</li>
<li>Add support for importing functions and constants from Python modules (by mapping Scheme functions to the <code>__import__</code> and <code>getattr</code> Python functions) so that the following will work:</li>
</ul>
<pre><code class="nohighlight">in&gt; (define math (py-import (quote math)))
in&gt; (define sqrt (getattr math (quote sqrt)))
in&gt; (sqrt 2)
    out&gt; 1.4142135623730951
</code></pre>
<p><script type="text/javascript">
        if (MathJax) {
            // Disable the MathJax right-click menu,
            // so that screenreader doesn't say "clickable" on every math element
            // Based on https://docs.mathjax.org/en/latest/web/configuration.html#configuring-mathjax-after-it-is-loaded
            MathJax.config.options = MathJax.config.options ?? {};
            MathJax.config.options.enableMenu = false;
            MathJax.startup.getComponents();
        }


        // give the hamburger menu icon an accessible label
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelector("a.icon")?.setAttribute('aria-label', 'site-menu');
        });
        
        // based on catsoop.modal
        catsoop.vprof_survey = function (header, text, vprof_link, link_timestamp) {
          return new Promise(function (resolve, reject) {
            var response = {
            "response": null,
            "vprof_link": vprof_link,
            "link_timestamp": link_timestamp,
            "response_timestamp": null,
            "make_modal_timestamp": Date.now(),
            };
            var content = document.createElement("dialog");
            content.classList = ["catsoop-modal-content"];
            content.setAttribute("aria-labelledby", "catsoop-dialog-header");
            content.setAttribute("aria-describedby", "catsoop-dialog-body");
            content.addEventListener("keydown", function (e) {
              // this piece traps focus in the dialog while it is open
              // based on https://hidde.blog/using-javascript-to-trap-focus-in-an-element/
              if (!content.open) {
                return;
              }
              if (e.key === "Tab" || e.keyCode === 9) {
                if (e.shiftKey) {
                  if (document.activeElement === content.focusable[0]) {
                    content.focusable[content.focusable.length - 1].focus();
                    e.preventDefault();
                  }
                } else if (
                  document.activeElement ===
                  content.focusable[content.focusable.length - 1]
                ) {
                  content.focusable[0].focus();
                  e.preventDefault();
                }
              }
            });
            content.focusable = [];

            var mbody = document.createElement("div");
            mbody.classList = ["catsoop-modal-body"];

            var close_button = document.createElement("button");
            close_button.classList = ["catsoop-modal-close"];
            close_button.innerHTML = "&times;";
            close_button.setAttribute("aria-label", "Close");
            close_button.onclick = function () {
              content.close(JSON.stringify(Object.assign(response, {"response": "cancel", "response_timestamp": Date.now()})));
            };
            content.focusable.push(close_button);
            mbody.append(close_button);

            var title = document.createElement("span");
            title.id = "catsoop-dialog-header";
            title.classList = ["catsoop-modal-header"];
            title.appendChild(document.createTextNode(header));
            title.setAttribute("role", "heading");
            mbody.appendChild(title);

            var body = document.createElement("p");
            body.id = "catsoop-dialog-body";
            body.innerHTML = text + "<br/>";
            mbody.appendChild(body);

            var buttons = document.createElement("span");
            var yes_button = document.createElement("button");
            yes_button.innerText = "Yes";
            yes_button.classList = ["btn btn-catsoop"];
            yes_button.addEventListener("click", function () {
              content.close(JSON.stringify(Object.assign(response, {"response": "yes", "response_timestamp": Date.now()})));
            });
            yes_button.setAttribute("autofocus", true);
            content.focusable.push(yes_button);


            var no_button = document.createElement("button");
            no_button.innerText = "No";
            no_button.classList = ["btn btn-catsoop"];
            no_button.addEventListener("click", function () {
              content.close(JSON.stringify(Object.assign(response, {"response": "no", "response_timestamp": Date.now()})));
            });
            content.focusable.push(no_button);

            buttons.appendChild(yes_button);
            buttons.appendChild(document.createTextNode(" "));
            buttons.appendChild(no_button);
            mbody.appendChild(buttons);

            content.addEventListener("close", function () {
              content.remove();
              last_clicked_vprof_report[0] = null;
              last_clicked_vprof_report[1] = null;
              showing_vprof_survey[0] = false;
              (content.returnValue === "" ? reject : resolve)(content.returnValue);
            });

            content.appendChild(mbody);
            document.body.appendChild(content);
            content.showModal();
          });
        };


        function postVprofSurveyResponse(value){
            var data = JSON.parse(value);
            var encoded_form_pairs = [];
            for (var name in data){
                encoded_form_pairs.push(encodeURIComponent(name) + '=' + encodeURIComponent(data[name]));
            }
            //console.log("data", data)
            var form = encoded_form_pairs.join('&').replace(/%20/g, '+');
            //console.log("form data", form);

            var request = new XMLHttpRequest();
            request.onload = function(){
                var msg = request.response;
                var data = JSON.parse(msg);
                //if(data.ok){
                //    console.log("post success")
                //}else{
                //    concole.log("post error", msg, JSON.stringify(data))
                //}
            }

            request.open('POST', "https://py.mit.edu/spring25/staffonly/analytics/vprof_survey_collector", true);
            request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            request.send(form);

        }

        var showing_vprof_survey = [false];
        var last_clicked_vprof_report = [null, null];

        document.addEventListener('visibilitychange', e=>{
          if (document.visibilityState === 'visible' &&
              last_clicked_vprof_report[0] !== null &&
              !showing_vprof_survey[0]) {
              // show vorif yes/no survey
              catsoop.vprof_survey("vprof survey",
                "Did <a href='" + last_clicked_vprof_report[0] + "' target='_blank'> this vprof report</a> help you find and/or fix an efficiency bug?",
                last_clicked_vprof_report[0], last_clicked_vprof_report[1]).then(postVprofSurveyResponse, postVprofSurveyResponse);
              showing_vprof_survey[0] = true;
            }
        })

        var vprof_links  = document.getElementsByClassName("vprof_link");
        for (var i=0; i < vprof_links.length; i++) {
            let my_link = vprof_links[i].href
            if ((typeof my_link === 'string' || my_link instanceof String) && !my_link.includes("#")) {
                vprof_links[i].href = my_link + '#78111110101-5a8a1e3f617e6a4d35394db299505c70891e32b6ef000e1aa29d2948a4ecd87f';
            }
            vprof_links[i].onclick = function(){
              last_clicked_vprof_report[0] = this.href;
              last_clicked_vprof_report[1] = Date.now();
            }
        }


    </script>
<script src="https://py.mit.edu/submission_nudger/socket.io/socket.io.js" type="text/javascript"></script>
<script type="text/javascript">
catsoop.nudger_id = '9bf4827783de91adf041f8b013edbf0b70695751e68c8e0cf134f32d93b2ec62';

var socket = io('https://py.mit.edu', {path: '/submission_nudger' + '/socket.io', autoConnect: false});

socket.on('connect', function(){
    socket.emit('hello', {id: catsoop.nudger_id});
});

socket.on('refresh', reload_code_submit);

socket.open();
</script></p>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
catsoop.all_questions = ['snekcode0', 'snekcode1', 'snekcode3', 'snekcode2', 'mapfilterreduce', 'code_submit'];
catsoop.username = null;
catsoop.this_path = 'https://py.mit.edu/spring25/labs/lisp_2';
catsoop.path_info = ['spring25', 'labs', 'lisp_2'];
catsoop.course = 'spring25';
catsoop.url_root = 'https://py.mit.edu';
catsoop.imp = '';
catsoop.skip_alert = [];
catsoop.viewans_confirm = "Are you sure?  Viewing the answer will prevent any further submissions to this question.  Press 'OK' to view the answer, or press 'Cancel' if you have changed your mind.";

// @license-end</script>
<div id="cs_footnotes"><br/>Â <hr/><b name="cs_footnotes">Footnotes</b><p><a class="anchor" name="catsoop_footnote_1"></a><sup style="padding-right:0.25em;color:var(--cs-base-bg-color);">1</sup>Recall that a "special form" is an
S-expression that doesn't follow the rules of a regular function
call. <a href="#catsoop_footnote_ref_1"><span class="noprint">(click to return to text)</span></a></p></div>
</div>
</div>
<div class="cs_right_menu"></div>
</div>
<footer>
<nav aria-label="Breadcrumbs" class="cs_navigation cs_bottom_navigation" id="cs_bottom_navigation"><li><a href="https://py.mit.edu/spring25">Home</a></li><li><a href="https://py.mit.edu/spring25/labs/lisp_2">LISP Interpreter, Part 2</a></li></nav>
<div class="cs_footer">
      This page was last updated on Wednesday May 14, 2025 at 04:06:05 PM (revision <code>d1706563</code>).<br/>Â <br/>
<pre class="catsooplogo" style="font-size:50%;">\            
/    /\__/\  
\__=(  o_O )=
(__________) 
 |_ |_ |_ |_ </pre>
      Powered by <a href="https://catsoop.org" target="_blank">CAT-SOOP</a> v19.0.6+hg.14.f36ce1d1 "Korat" (LTS) (development snapshot).<br/>
      CAT-SOOP is <a href="https://www.fsf.org/about/what-is-free-software" target="_blank">Free/Libre Software</a>, available under the terms<br/>of the <a href="https://py.mit.edu/_util/license" target="_blank">GNU Affero General Public License, version 3</a>.<br/>
<a download="" href="https://py.mit.edu/_util/source.zip" target="_blank">Download Source Code</a><br/>
<a href="https://py.mit.edu/_util/jslicense.html" rel="jslicense" target="_blank">Javascript License Information</a>
</div>
</footer>
</body>
</html>

