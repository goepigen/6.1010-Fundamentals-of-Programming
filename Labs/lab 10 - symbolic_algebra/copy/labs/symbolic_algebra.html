<!DOCTYPE html>

<html>
<head>
<!-- This page was generated by CAT-SOOP 19.0.6+hg.14.f36ce1d1.  miau. -->
<meta charset="utf-8"/>
<title>Symbolic Algebra | 6.101 Spring 2025</title>
<link href="https://py.mit.edu/_static/spring25/logo.gif" rel="icon" type="image/gif"/>
<!-- include catsoop base css -->
<link href="https://py.mit.edu/_static/_base/themes/base.css" rel="stylesheet" type="text/css"/>
<!-- set up JS namespace for catsoop -->
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    var catsoop = {plugins: {}};

    function toggleResponsiveHeader(){
        document.getElementsByTagName('header')[0].classList.toggle('responsive');
    }

    function toggleAttribute(elt, attr){
        elt.setAttribute(attr, elt.getAttribute(attr) === "true" ? "false" : "true");
    }

    catsoop.topMenuFocus = function(event) {
        var elt = event.target;
        var target = event.relatedTarget;
        if (elt.classList.contains('menu-submenu')){
            var topmenu = elt.parentNode.parentNode;
            if (target && !target.classList.contains("menu-submenu") && target !== topmenu.children[1]) {
                clearMenu(topmenu);
            }
        }else if (!target.classList.contains('cs_top_menu_item')){
            clearMenu(elt.parentNode);
        }
    }

    window.addEventListener('DOMContentLoaded', function(){
        var menu_boxes = document.getElementsByClassName('dropdown-checkbox');
        for(var i=0; i<menu_boxes.length; i++){
            menu_boxes[i].checked = false;
        }
    });

    function clearMenu(menu){
       menu.children[1].checked = false;
    }
    // @license-end
    </script>
<!-- dark mode -->
<script src="https://py.mit.edu/_static/_base/js/darkreader/darkreader.min.js" type="text/javascript"></script>
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    catsoop.dark_mode_settings = null;
    if (catsoop.dark_mode_settings === null){
        catsoop.dark_mode_settings = JSON.parse(localStorage.getItem('catsoop_dark_mode_settings'));
        if (catsoop.dark_mode_settings === null){
            catsoop.dark_mode_settings = {'mode': 'disabled', 'brightness': 100, 'contrast': 90, 'sepia': 10, 'grayscale': 0};
        }
    }
    localStorage.setItem('catsoop_dark_mode_settings', JSON.stringify(catsoop.dark_mode_settings));
    catsoop.dark_mode = catsoop.dark_mode_settings.mode;
    delete catsoop.dark_mode_settings.mode;
    if (catsoop.dark_mode === 'enabled' || catsoop.dark_mode === 'auto'){
        DarkReader[catsoop.dark_mode == 'enabled' ? 'enable' : 'auto'](catsoop.dark_mode_settings);
    }
    
    document.addEventListener("DOMContentLoaded", function(event) {
        if (DarkReader.isEnabled()) {
            var invertfilter = 'invert(100%) hue-rotate(180deg)' +
                               ' brightness(' + catsoop.dark_mode_settings.brightness + '%)' +
                               ' contrast(' + catsoop.dark_mode_settings.contrast + '%)' +
                               ' grayscale(' + catsoop.dark_mode_settings.grayscale + '%)' +
                               ' sepia(' + catsoop.dark_mode_settings.sepia + '%)'
            var inverter = document.createElement('style');
            inverter.innerText = 'img.catsoop-darkmode-invert, video.catsoop-darkmode-invert {filter: ' + invertfilter + ';}\n\n'
            document.head.appendChild(inverter);
        }
    });
    // @license-end
    </script>
<!-- load in mathjax and CAT-SOOP-specific math rendering  -->
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    MathJax = {
      startup: {
        typeset: false,
      }
    }

    catsoop.render_math = function (elt) {
        if(elt.classList.contains('cs_displaymath')){
            var b = "\\[";
            var e = "\\]";
        }else{
            var b = "\\(";
            var e = "\\)";
        }
        elt.innerText = b + elt.innerText + e;
        MathJax.typeset([elt]);
        elt.classList.remove('cs_math_to_render');
    }


    catsoop.render_all_math = function (elt){
        if (elt === null) {
            return;
        }
        var mathelts = elt.getElementsByClassName('cs_math_to_render');
        while(mathelts.length > 0){
            catsoop.render_math(mathelts[0]);
        }
    }
    document.addEventListener("DOMContentLoaded", function(event) {
          catsoop.render_all_math(document);
    });
    // @license-end
    </script>
<script id="MathJax-script" src="https://py.mit.edu/_static/_base/js/mathjax/tex-chtml-full-speech.js"></script>
<!-- load in diagram stuff -->
<script src="https://py.mit.edu/_static/_base/js/cs_diagrams.js" type="text/javascript"></script>
<script type="text/javascript">
        catsoop.diagram_sources = {};
    </script>
<!-- Syntax Highlighting -->
<script src="https://py.mit.edu/_static/_base/js/highlight/highlight.min.js" type="text/javascript"></script>
<script src="https://py.mit.edu/_static/_base/js/highlightjs-line-numbers.js" type="text/javascript"></script>
<script type="text/javascript">
    // @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
    catsoop.syntax_highlighting = function (elt) {
        if (elt === null) {
            return;
        }
        elt.querySelectorAll('pre > code:not(.highlighted)').forEach((block) => {
            hljs.highlightBlock(block);
            var wrap = document.createElement("section");
            wrap.setAttribute("aria-label", "Code block");
            block.parentNode.replaceWith(wrap);
            wrap.append(block.parentNode);
            block.classList.add('highlighted');
        });
        elt.querySelectorAll('code.highlight-lines').forEach(function(b){
            hljs.lineNumbersBlock(b);
            if ((b.innerHTML.trim().match(/\r\n|\r|\n/g) || []).length > 0){
                b.parentElement.style = "padding-left: 0px !important;"
                b.classList.add('hljs');
            }
            b.classList.remove('highlight-lines');
        });
    }
    window.addEventListener('DOMContentLoaded', function(){
        catsoop.syntax_highlighting(document);
    });
    // @license-end
    </script>
<style>
      :root {
        --cs-base-bg-color: #0350ba;
        --cs-light-bg-color: #629ced;
        --cs-base-font-color: #fff;
        --cs-light-font-color: #000;
    }
    </style>
<style>
.cs_top_menu_item {
  font-size: 0.88rem;
}
div.dropdown {
  -moz-transform: translateY(-1px);
}
img {
  max-width:100% !important;
}
.visually-hidden {
	position: absolute !important;
	width: 1px !important;
	height: 1px !important;
	padding: 0 !important;
	margin: -1px !important;
	overflow: hidden !important;
	clip: rect(0,0,0,0) !important;
	white-space: nowrap !important;
	border: 0 !important;
}
kbd {
  background-color: #eee;
  border-radius: 3px;
  border: 1px solid #b4b4b4;
  box-shadow:
    0 1px 1px rgba(0, 0, 0, 0.2),
    0 2px 0 0 rgba(255, 255, 255, 0.7) inset;
  color: #333;
  display: inline-block;
  font-size: 0.85em;
  font-weight: 700;
  line-height: 1;
  padding: 2px 4px;
  white-space: nowrap;
}
</style>
<style>
[id^=cs_qdiv].question-lab101 [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101 [id$=nsubmits_left] {
  display: none;
}

[id^=cs_qdiv].question-lab101_vprof [id$=buttons] {
  display: none;
}
[id^=cs_qdiv].question-lab101_vprof [id$=nsubmits_left] {
  display: none;
}

</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
document.addEventListener("DOMContentLoaded", function(){
    sessionStorage.setItem("last-non-settings", catsoop.this_path);
});
// @license-end
</script>
<script type="text/javascript">
function reload_code_submit() {
    fetch("?action=render_single_question&name=code_submit")
      .then((result) => {return result.text();})
      .then(result => {
        document.getElementById("cs_qdiv_code_submit").innerHTML = result;
        catsoop.run_all_scripts("cs_qdiv_code_submit");
       });
}

</script>
<script src="https://py.mit.edu/_static/_handler/default/cs_ajax.js" type="text/javascript"></script>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
</head>
<body style="margin: 0px;">
<header id="cs_header">
<div aria-role="menubar" class="nav-container">
<div class="cs_header_text"><a href="https://py.mit.edu/spring25"><img src="https://py.mit.edu/_static/spring25/logo.gif"/>Â 6.101</a></div>
<div class="dropdown" onmouseleave="clearMenu(this);">
<label class="dropbtn cs_top_menu_item" for="cs_menu_c1a43e3f699a1ed71997b0321c2e9ffd">Information<span aria-hidden="true" class="downarrow">â¼</span></label>
<input checked="false" class="dropdown-checkbox screenreader-only-clip menu-toplevel" id="cs_menu_c1a43e3f699a1ed71997b0321c2e9ffd" onblur="catsoop.topMenuFocus(event);" role="menuitemcheckbox" type="checkbox"/>
<div class="dropdown-content">
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/basics" onblur="catsoop.topMenuFocus(event);" role="menuitem">Basics and Schedule</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/grading" onblur="catsoop.topMenuFocus(event);" role="menuitem">Grading Policies</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/academic_integrity" onblur="catsoop.topMenuFocus(event);" role="menuitem">Academic Integrity</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/help" onblur="catsoop.topMenuFocus(event);" role="menuitem">Getting Help</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/infrastructure" onblur="catsoop.topMenuFocus(event);" role="menuitem">Infrastructure</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/info/staff" onblur="catsoop.topMenuFocus(event);" role="menuitem">Staff List</a></div></div>
<div class="dropdown" onmouseleave="clearMenu(this);">
<label class="dropbtn cs_top_menu_item" for="cs_menu_ee51a2d5002bd02613936bd9b2f3dbee">Materials<span aria-hidden="true" class="downarrow">â¼</span></label>
<input checked="false" class="dropdown-checkbox screenreader-only-clip menu-toplevel" id="cs_menu_ee51a2d5002bd02613936bd9b2f3dbee" onblur="catsoop.topMenuFocus(event);" role="menuitemcheckbox" type="checkbox"/>
<div class="dropdown-content">
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/calendar" onblur="catsoop.topMenuFocus(event);" role="menuitem">Calendar</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/readings" onblur="catsoop.topMenuFocus(event);" role="menuitem">Readings</a>
<a class="cs_top_menu_item menu-submenu" href="https://py.mit.edu/spring25/labs" onblur="catsoop.topMenuFocus(event);" role="menuitem">Labs</a></div></div>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring25/progress" onblur="catsoop.topMenuFocus(event);" role="menuitem">Progress</a>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring25/queue" onblur="catsoop.topMenuFocus(event);" role="menuitem">Queue</a>
<a class="cs_top_menu_item menu-toplevel" href="https://py.mit.edu/spring25/labs/symbolic_algebra?loginaction=login" onblur="catsoop.topMenuFocus(event);" role="menuitem">Log In</a><a class="icon" href="javascript:void(0);" onclick="toggleResponsiveHeader()">â°</a>
</div>
</header>
<nav aria-label="Breadcrumbs" class="cs_navigation cs_top_navigation" id="cs_breadcrumbs"><li><a href="https://py.mit.edu/spring25">Home</a></li><li><a href="https://py.mit.edu/spring25/labs/symbolic_algebra">Symbolic Algebra</a></li></nav>
<div class="cs_body" id="cs_body">
<div class="cs_left_menu"></div>
<div class="cs_content">
<div class="cs_page_body" role="main">
<center><h1 class="cs_content_header">Symbolic Algebra</h1></center>
<div class="response" id="catsoop_login_box">
<b><center>You are not logged in.</center></b><br/>
Please <a href="https://py.mit.edu/spring25/labs/symbolic_algebra?loginaction=login">Log
In</a> for full access to the web site.<br/>Note that this link will take you to
an external site (<tt>https://shimmer.mit.edu</tt>) to authenticate, and then you will be redirected
back to this page.
</div>
<style>
html {
    color: #333;
}
</style>
<h2 aria-hidden="true">Table of Contents</h2><ul aria-label="Table of Contents" role="navigation"><li><a href="#_preparation">1) Preparation</a></li><li><a href="#_introduction">2) Introduction</a></li><li><a href="#_basic_symbolic_expressions">3) Basic Symbolic Expressions</a></li><li><a href="#_binary_operations">4) Binary Operations</a></li><li><a href="#_display">5) Display</a></li><ul><li><a href="#_parenthesization">5.1) Parenthesization</a></li></ul><li><a href="#_using_python_operators_with_symbolic_expressions">6) Using Python Operators with Symbolic Expressions</a></li><li><a href="#_evaluation">7) Evaluation</a></li><li><a href="#_derivatives">8) Derivatives</a></li><li><a href="#_simplification">9) Simplification</a></li><li><a href="#_parsing_symbolic_expressions">10) Parsing Symbolic Expressions</a></li><ul><li><a href="#_tokenizing">10.1) Tokenizing</a></li><li><a href="#_parsing">10.2) Parsing</a></li></ul><li><a href="#_type_checking_considerations">11) Type Checking Considerations</a></li><li><a href="#_code_submission">12) Code Submission</a></li><li><a href="#_checkoff">13) Checkoff</a></li><li><a href="#_additional_optional_extensions">14) Additional (Optional) Extensions</a></li></ul>
<p><a class="anchor" name="catsoop_section_1"></a><a class="anchor" name="_preparation"></a><h2 class="cs_section_title">1) Preparation<a class="cs_permalink" href="#_preparation">Â§</a></h2></p>
<div class="callout callout-note"><div class="callout-title">Note</div>
<p>You may wish to read the whole lab before implementing
any code, so that you can make a more complete plan before diving in.  Try
making a plan for your code, including the following:</p><ul>
<li>Which classes are you going to implement?  Which classes are subclasses of which classes?</li>
<li>What attributes are stored in each class?</li>
<li>What methods does each class have?</li>
</ul><p>As you work through, be on the lookout for opportunities to take advantage
of inheritance to avoid repetitious code!</p><p>Throughout the lab, you should not use Python's <code>eval</code>,
<code>exec</code>, <code>isinstance</code>, or <code>type</code> built-ins, nor should you be explicitly
checking for the type of any particular object, except where we have indicated
that it is okay to do so.  Instead of explicitly checking the types of our
objects and determining our behavior based on those results, our goal is to
use Python's own mechanism of method/attribute lookup to implement these
different behaviors without the need to do any type checking of our own.</p><p>Things that are considered "explicit type checking" include not only checks
using <code>type</code> or <code>isinstance</code>, but also using unique class attributes as a
way to ask the same question one would ask of
<code>isinstance</code> or <code>type</code> (what class is this object an instance of?).</p><p>Some of the test cases attempt to check that you're following these guidelines.
They are not perfect, but if you are failing any of the tests labeled with
<code>_types</code> on the end of the name, it likely means that your code is implementing
some kind of type checking that we are not expecting.</p>
</div>
<p>This lab assumes you have Python 3.11 or later installed on your machine (3.13
recommended).</p>
<p>The following file contains code and other resources as a starting point for
this lab: <a download="symbolic_algebra.zip" href="https://py.mit.edu/spring25/lab_distribution.zip?path=%5B%22spring25%22%2C+%22labs%22%2C+%22symbolic_algebra%22%5D"><tt>symbolic_algebra.zip</tt></a></p>
<p>Most of your changes should be made to <code>lab.py</code>, which you will submit
at the end of this lab.  Importantly, you should not add any imports
to the file.</p>
<p>Note that passing all of the tests on the server will require that
your code runs reasonably efficiently.</p>
<p>Your raw score for this lab will be counted out of 5 points.  Your score for
the lab is based on:</p>
<ul>
<li>passing the tests in <code>test.py</code> (3 points)</li>
<li>a brief "checkoff" conversation with a staff member about your code (2 points)</li>
</ul>
<p>All of the questions on this page, including your code submission, are due at
5:00pm on Friday, 25 April.  Checkoffs are due at 10:00pm on Wednesday, 30 April.
<strong>It is a good idea to submit your lab early and often so that if something
goes wrong near the deadline, we have a record of the work you completed before
then.</strong>  We recommend submitting your lab to the server after finishing each
substantial portion of the lab.</p>
<div class="callout callout-error"><div class="callout-title">Reminder: Academic Integrity</div>
<p>Please also review the <a href="https://py.mit.edu/spring25/info/academic_integrity">academic-integrity policies</a> before
continuing.  In particular, <strong>note that you are not allowed to use any code
other than that which you have written yourself, including code from online sources.</strong></p>
</div>
<p><a class="anchor" name="catsoop_section_2"></a><a class="anchor" name="_introduction"></a><h2 class="cs_section_title">2) Introduction<a class="cs_permalink" href="#_introduction">Â§</a></h2></p>
<p>In this lab, we will develop a Python framework for symbolic algebra.  In such
a system, algebraic expressions including variables and numbers are not
immediately evaluated but rather are stored in symbolic form.</p>
<p>These kinds of systems abound in the "real world," and they can be incredibly
useful.  Examples of similar systems include Wolfram Alpha and <a href="https://www.sympy.org/en/index.html">Sympy</a> (a really impressive
open-source Python module for symbolic algebra).  We won't quite approach the
sophistication of those kinds of packages in this lab, but we'll get a pretty
good start in that direction!</p>
<p>We'll start by implementing support for basic arithmetic (<code>+</code>, <code>-</code>, <code>*</code>, and
<code>/</code>) on variables and numbers, and then we'll add support for simplification
and differentiation of these symbolic expressions.  Ultimately, this system
will be able to support interactions such as the following:</p>
<pre><code class="language-py">&gt;&gt;&gt; x = Var('x')
&gt;&gt;&gt; y = Var('y')
&gt;&gt;&gt; print(x + y)
x + y
&gt;&gt;&gt; z = x + 2*x*y + x
&gt;&gt;&gt; print(z)
x + 2 * x * y + x
&gt;&gt;&gt; print(z.deriv('x'))  # derivative of z with respect to x
1 + 2 * x * 0 + y * (2 * 1 + x * 0) + 1
&gt;&gt;&gt; print(z.deriv('x').simplify())
1 + y * 2 + 1
&gt;&gt;&gt; print(z.deriv('y'))  # derivative of z with respect to y
0 + 2 * x * 1 + y * (2 * 0 + x * 0) + 0
&gt;&gt;&gt; print(z.deriv('y').simplify())
2 * x
&gt;&gt;&gt; z.evaluate({'x': 3, 'y': 7})  # evaluate an expression with particular values for the variables
48
</code></pre>
<p><a class="anchor" name="catsoop_section_3"></a><a class="anchor" name="_basic_symbolic_expressions"></a><h2 class="cs_section_title">3) Basic Symbolic Expressions<a class="cs_permalink" href="#_basic_symbolic_expressions">Â§</a></h2></p>
<p>In this week's code distribution, we have provided a very minimal skeleton,
containing a small definition for three classes:</p>
<ul>
<li><code>Expr</code> will be our base class; all other classes we create will inherit from this class, and any behavior that is common between all symbolic expressions (that is, all behavior that is not unique to a particular <em>kind</em> of symbolic expression) should be implemented here.</li>
<li>Instances of <code>Var</code> represent variables (such as <span class="cs_math_to_render">x</span> or <span class="cs_math_to_render">y</span>).</li>
<li>Instances of <code>Num</code> represent numbers within symbolic expressions.</li>
</ul>
<p>Take a look at the <code>Var</code> and <code>Num</code> classes.  Note that each has <a href="https://docs.python.org/3/reference/datamodel.html#object.__init__" target="_blank"><code>__init__</code></a>,
<a href="https://docs.python.org/3/reference/datamodel.html#object.__repr__" target="_blank"><code>__repr__</code></a>, and <a href="https://docs.python.org/3/reference/datamodel.html#object.__str__" target="_blank"><code>__str__</code></a> defined for you already.  Importantly, while you
are welcome to add additional machinery to these objects if you want to, it
will be important that the existing instance variables continue to work as
they do in the provided skeletons (our test suite relies on this behavior).</p>
<p><a class="anchor" name="catsoop_section_4"></a><a class="anchor" name="_binary_operations"></a><h2 class="cs_section_title">4) Binary Operations<a class="cs_permalink" href="#_binary_operations">Â§</a></h2></p>
<p>So far, our system is somewhat uninteresting.  It lets us represent variables
and numbers, but in order to be able to represent meaningful expressions, we
also need ways of combining these primitive symbols together.  In particular,
we will represent these kinds of combinations as <em>binary operations</em>.  You
should implement a class called <code>BinOp</code> to represent a binary operation.
Because it is a type of symbolic expression, <code>BinOp</code> should be a subclass of
<code>Expr</code>.</p>
<p>We will start with four subclasses of <code>BinOp</code>:</p>
<ul>
<li><code>Add</code>, to represent an addition</li>
<li><code>Sub</code>, to represent a subtraction</li>
<li><code>Mul</code>, to represent a multiplication</li>
<li><code>Div</code>, to represent a division</li>
</ul>
<p>By virtue of being binary operations, each instance of any of these classes
should have two instance variables:</p>
<ul>
<li><code>left</code>: an <code>Expr</code> instance representing the left-hand operand</li>
<li><code>right</code>: an <code>Expr</code> instance representing the right-hand operand</li>
</ul>
<p>For example, <code>Add(Add(Var('x'), Num(3)), Num(2))</code> represents the symbolic
expression <span class="cs_math_to_render">x + 3 + 2</span>.  The <code>left</code> attribute of this instance should be the
<code>Add</code> instance <code>Add(Var('x'), Num(3))</code>, and the <code>right</code> attribute
should be the <code>Num</code> instance <code>Num(2)</code>.</p>
<p>Importantly, instances of <code>BinOp</code> (or subclasses thereof) <strong>should <em>only</em> have
these two instance attributes</strong>.  You are welcome to store additional
information in class attributes, but each instance should only store <code>left</code> and
<code>right</code>.</p>
<div class="question"><b>Check Yourself:</b><p>The structure of each of these classes' <a href="https://docs.python.org/3/reference/datamodel.html#object.__init__" target="_blank"><code>__init__</code></a> methods is likely to be
almost the same (if not exactly the same).  What does that suggest about
how/where you should implement <a href="https://docs.python.org/3/reference/datamodel.html#object.__init__" target="_blank"><code>__init__</code></a>?</p><p><span id="queue_checkyourself_1"></span></p></div>
<p>These constructors should also accept integers, floats, or strings as their arguments.
<code>Add(2, 'x')</code>, for example, should create an instance <code>Add(Num(2), Var('x'))</code>.
<strong>It is okay to use <code>isinstance</code> or <code>type</code> in this context, to check if the
arguments passed to the constructor are strings or numbers.</strong></p>
<p>Note: it is good style to include docstrings for classes. According to <a href="https://peps.python.org/pep-0257/">PEP257
style guidelines</a>, "The docstring for a class
should summarize its behavior and list the public methods and instance variables."
For our purposes, a one-line sentence summary for each class should suffice.</p>
<p><a class="anchor" name="catsoop_section_5"></a><a class="anchor" name="_display"></a><h2 class="cs_section_title">5) Display<a class="cs_permalink" href="#_display">Â§</a></h2></p>
<p>As of right now, attempting to print an instance of <code>BinOp</code> (or a subclass
thereof) will not really tell us much useful information.  In this section,
we'll improve on Python's ability to display these objects.</p>
<p>Python has two different ways to get a representation of an object as
a string. First, <code>repr(obj)</code> (which calls <code>obj.__repr__()</code> under-the-hood) should
produce a string containing a representation that, when passed back into
a Python interpreter, would evaluate to an equivalent object. Second, <code>str(obj)</code> (which calls
<code>obj.__str__()</code> under-the-hood) should produce a human-readable string
representation.</p>
<div class="question"><b>Check Yourself:</b><p>Take a look at the <a href="https://docs.python.org/3/reference/datamodel.html#object.__repr__" target="_blank"><code>__repr__</code></a> and <a href="https://docs.python.org/3/reference/datamodel.html#object.__str__" target="_blank"><code>__str__</code></a> methods in <code>Var</code> and <code>Num</code>.  What
is the difference between them?</p><p><span id="queue_checkyourself_2"></span></p></div>
<p>Implement <a href="https://docs.python.org/3/reference/datamodel.html#object.__repr__" target="_blank"><code>__repr__</code></a> and <a href="https://docs.python.org/3/reference/datamodel.html#object.__str__" target="_blank"><code>__str__</code></a> in appropriate places (avoiding repeating
code where possible), such that, for any symbolic expression <code>sym</code>, <code>repr(sym)</code>
will produce a string containing a Python expression that, when evaluated,
will result in a symbolic expression equivalent to <code>sym</code>.  Similarly, <code>str(sym)</code>
should produce a human-readable representation, given by
<code>left_string + ' ' + operator + ' ' + right_string</code>, where <code>left_string</code> and <code>right_string</code> are the
string representations of the <code>left</code> and <code>right</code> attributes, respectively, and
<code>operator</code> is a string representation of the operator associated with the
specific class in question.  For example:</p>
<pre><code class="language-py">&gt;&gt;&gt; z = Add(Var('x'), Sub(Var('y'), Num(2)))
&gt;&gt;&gt; repr(z)  # notice that this result, if fed back into Python, produces an equivalent object.
"Add(Var('x'), Sub(Var('y'), Num(2)))"
&gt;&gt;&gt; str(z)  # this result cannot necessarily be fed back into Python, but it looks nicer.
'x + y - 2'
</code></pre>
<p>Note: you may access a string containing the class name using the following syntax:</p>
<pre><code class="language-py">&gt;&gt;&gt; z = Num(2)
&gt;&gt;&gt; z.__class__.__name__
Num
</code></pre>
<p><a class="anchor" name="catsoop_section_5_1"></a><a class="anchor" name="_parenthesization"></a><h3 class="cs_section_title">5.1) Parenthesization<a class="cs_permalink" href="#_parenthesization">Â§</a></h3></p>
<p>Note that, while a <a href="https://docs.python.org/3/reference/datamodel.html#object.__repr__" target="_blank"><code>__repr__</code></a> implementation that follows the rules described
above works well for complicated expressions (as seen in the expressions
in the last example above), a <a href="https://docs.python.org/3/reference/datamodel.html#object.__str__" target="_blank"><code>__str__</code></a> implementation that
follows those rules results in some possible ambiguities or erroneous
interpretations.  In particular, consider the expression
<code>Mul(Var('x'), Add(Var('y'), Var('z')))</code>.  According to the rules above for
<a href="https://docs.python.org/3/reference/datamodel.html#object.__str__" target="_blank"><code>__str__</code></a>, that
expression's string representation would be <code>"x * y + z"</code>, but the internal
structure of the expression suggests something different!  It would be nice for
the string representation instead to be <code>"x * (y + z)"</code>, to better align with the
actual structure represented by the expression.</p>
<p>To address this, we add rules for parenthesization as follows, where <code>B</code> is the <code>BinOp</code>
instance whose string representation we are finding<a class="anchor" name="catsoop_footnote_ref_1"></a><a href="#catsoop_footnote_1"><sup>1</sup></a>:</p>
<ul>
<li>If <code>B.left</code> and/or <code>B.right</code>
themselves represent expressions with lower precedence than <code>B</code>, wrap their string
representations in parentheses (here, precedence is defined using the
standard
"<a href="https://en.wikipedia.org/wiki/Order_of_operations#Mnemonics" target="_blank">PEMDAS</a>"
ordering).</li>
<li>As a special case, if <code>B</code> represents a subtraction or a division and <code>B.right</code>
represents an expression with <em>the same precedence</em> as <code>B</code>, wrap <code>B.right</code>'s string
representation in parentheses.</li>
</ul>
<p>Individual numbers or variables should never be wrapped in parentheses.</p>
<div class="question"><b>Check Yourself:</b><p>Think about the rules for parenthesization described above in terms of algebraic expressions and
work through parenthesizing some example expressions by hand to get a feel for
how these rules work.  Do these rules seem to work in a general sense -- will they
always work across
different operations and across different levels of expression complexity?  Why do
they work?  Why are subtraction and division treated differently from addition
and multiplication?</p><p><span id="queue_checkyourself_3"></span></p></div>
<p>Importantly, you should implement the behavior for <a href="https://docs.python.org/3/reference/datamodel.html#object.__str__" target="_blank"><code>__str__</code></a> and <a href="https://docs.python.org/3/reference/datamodel.html#object.__repr__" target="_blank"><code>__repr__</code></a> without
checking the type of <code>self</code>, <code>self.left</code>, or <code>self.right</code>.</p>
<p><a class="anchor" name="catsoop_section_6"></a><a class="anchor" name="_using_python_operators_with_symbolic_expressions"></a><h2 class="cs_section_title">6) Using Python Operators with Symbolic Expressions<a class="cs_permalink" href="#_using_python_operators_with_symbolic_expressions">Â§</a></h2></p>
<p>Entering expressions of the form <code>Add(Var('x'), Add(Num(3), Num(2)))</code> can get a
little bit tedious.  It would be much nicer, for example, to be able to enter
that expression as <code>Var('x') + Num(3) + Num(2)</code>.</p>
<p>Add methods to appropriate class(es) in your file such that, for any
arbitrary symbolic expressions <code>E1</code> and <code>E2</code>:</p>
<ul>
<li><code>E1 + E2</code> results in an instance <code>Add(E1, E2)</code><br/>(note: you can override the behavior of <code>+</code> with the <a href="https://docs.python.org/3/reference/datamodel.html#object.__add__" target="_blank"><code>__add__</code></a> and <a href="https://docs.python.org/3/reference/datamodel.html#object.__radd__" target="_blank"><code>__radd__</code></a> "dunder" methods)</li>
<li><code>E1 - E2</code> results in an instance <code>Sub(E1, E2)</code><br/>(note: you can override the behavior of <code>-</code> with the <a href="https://docs.python.org/3/reference/datamodel.html#object.__sub__" target="_blank"><code>__sub__</code></a> and <a href="https://docs.python.org/3/reference/datamodel.html#object.__rsub__" target="_blank"><code>__rsub__</code></a> "dunder" methods)</li>
<li><code>E1 * E2</code> results in an instance <code>Mul(E1, E2)</code><br/>(note: you can override the behavior of <code>*</code> with the <a href="https://docs.python.org/3/reference/datamodel.html#object.__mul__" target="_blank"><code>__mul__</code></a> and <a href="https://docs.python.org/3/reference/datamodel.html#object.__rmul__" target="_blank"><code>__rmul__</code></a> "dunder" methods)</li>
<li><code>E1 / E2</code> results in an instance <code>Div(E1, E2)</code><br/>(note: you can override the behavior of <code>/</code> with the <a href="https://docs.python.org/3/reference/datamodel.html#object.__truediv__" target="_blank"><code>__truediv__</code></a> and <a href="https://docs.python.org/3/reference/datamodel.html#object.__rtruediv__" target="_blank"><code>__rtruediv__</code></a> "dunder" methods)</li>
</ul>
<div class="question"><b>Check Yourself:</b><p>It is a good idea to avoid duplicating code when implementing these behaviors!  In what
class(es) should you implement <a href="https://docs.python.org/3/reference/datamodel.html#object.__add__" target="_blank"><code>__add__</code></a>?</p><p><span id="queue_checkyourself_4"></span></p></div>
<p>These behaviors should work so long as <em>at least one</em> of <code>E1</code> and <code>E2</code> is a
symbolic expression, and the other is either a symbolic expression, a number,
or a string.</p>
<p>For example:</p>
<pre><code class="language-py">&gt;&gt;&gt; Var('a') * Var('b')
Mul(Var('a'), Var('b'))
&gt;&gt;&gt; 2 + Var('x')
Add(Num(2), Var('x'))
&gt;&gt;&gt; Num(3) / 2
Div(Num(3), Num(2))
&gt;&gt;&gt; Num(3) + 'x'
Add(Num(3), Var('x'))
</code></pre>
<div class="callout callout-note"><div class="callout-title">Note</div>
<p>We have seen <a href="https://docs.python.org/3/reference/datamodel.html#object.__add__" target="_blank"><code>__add__</code></a>, <a href="https://docs.python.org/3/reference/datamodel.html#object.__sub__" target="_blank"><code>__sub__</code></a>, <a href="https://docs.python.org/3/reference/datamodel.html#object.__mul__" target="_blank"><code>__mul__</code></a>, and <a href="https://docs.python.org/3/reference/datamodel.html#object.__truediv__" target="_blank"><code>__truediv__</code></a> before, but
what about the versions with the <code>r</code> on the front of them?  They represent
the same operations but with the operands swapped.</p><p>It turns out that Python has a small set of rules for deciding which of
these methods to call in various situations.  For example, consider the small
expression <code>x + y</code>.  In order to decide what to do here, Python will:</p><ol>
<li>If <code>x</code> is not a built-in type, and it has an <a href="https://docs.python.org/3/reference/datamodel.html#object.__add__" target="_blank"><code>__add__</code></a> method, invoke <code>x.__add__(y)</code>.</li>
<li>Otherwise, if <code>x</code> and <code>y</code> are of different types, and if <code>y</code> has an <a href="https://docs.python.org/3/reference/datamodel.html#object.__radd__" target="_blank"><code>__radd__</code></a> method, invoke <code>y.__radd__(x)</code>.</li>
</ol><p>In the context of our program, implementing both <a href="https://docs.python.org/3/reference/datamodel.html#object.__add__" target="_blank"><code>__add__</code></a> and <a href="https://docs.python.org/3/reference/datamodel.html#object.__radd__" target="_blank"><code>__radd__</code></a> will allow both of the following expressions to work:</p><pre><code class="language-python">&gt;&gt;&gt; x = Var('x')
&gt;&gt;&gt; x + 2  # here, __add__ will be called
Add(Var('x'), Num(2))
&gt;&gt;&gt; 2 + x  # here, __radd__ will be called
Add(Num(2), Var('x'))
</code></pre><p>Feel free to ask us if you have questions about this!  The page of the
Python documentation about the <a href="https://docs.python.org/3/reference/datamodel.html">Python Data
Model</a> has more information
about these methods as well.</p>
</div>
<p>Note that you should be able to implement this behavior without additional
explicit type checking.</p>
<p><a class="anchor" name="catsoop_section_7"></a><a class="anchor" name="_evaluation"></a><h2 class="cs_section_title">7) Evaluation<a class="cs_permalink" href="#_evaluation">Â§</a></h2></p>
<p>Next, we'll add support for evaluating expressions for particular values of
variables.  Add method(s) to your class(es) such that, for any symbolic
expression <code>sym</code>, <code>sym.evaluate(mapping)</code> will find a numerical value (meaning a
<code>float</code> or an <code>int</code>, not an instance of <code>Num</code>) for the given expression.  <code>mapping</code>
should be a dictionary mapping variable names to values.</p>
<p>For example:</p>
<pre><code class="language-py">&gt;&gt;&gt; z = Add(Var('x'), Sub(Var('y'), Mul(Var('z'), Num(2))))
&gt;&gt;&gt; z.evaluate({'x': 7, 'y': 3, 'z': 9})
-8
&gt;&gt;&gt; z.evaluate({'x': 3, 'y': 10, 'z': 2})
9
</code></pre>
<p>In the test cases we'll run, the given dictionary will not always contain all of
the bindings needed to evaluate the expression fully.  The test cases will not
just expect one of Python's built-in exceptions to happen when this occurs, though;
instead, you should implement a custom exception type called <code>SymbolicEvaluationError</code>,
and raise this new kind of exception when this kind of error occurs.  You can
create this new kind of exception by making a new (empty) class that inherits from
<code>Exception</code>, like so:</p>
<pre><code class="language-py">class SymbolicEvaluationError(Exception):
    """
    An expression indicating that something has gone wrong when evaluating a
    symbolic algebra expression.
    """
    pass
</code></pre>
<p>If a dictionary does not contain all of the necessary bindings to perform the
evaluation, your code should raise a <code>SymbolicEvaluationError</code> with an
appropriate error message.</p>
<p>Note that representing mathematically undefined expressions like <code>0 / 0</code> or
<code>x / 0</code> using our <code>Expr</code> classes should not cause errors. The tests do not attempt
to evaluate undefined expressions, but you may add code to handle these cases
if you want.</p>
<p><a class="anchor" name="catsoop_section_8"></a><a class="anchor" name="_derivatives"></a><h2 class="cs_section_title">8) Derivatives<a class="cs_permalink" href="#_derivatives">Â§</a></h2></p>
<p>Next, we'll make the computer do our 18.01 homework for us.  Well, not quite.
But we'll implement support for symbolic differentiation.  In particular, we
would like to implement the following rules for partial derivatives (where <span class="cs_math_to_render">x</span>
is an arbitrary variable, <span class="cs_math_to_render">c</span> is a constant or a variable other than <span class="cs_math_to_render">x</span>, and
<span class="cs_math_to_render">u</span> and <span class="cs_math_to_render">v</span> are arbitrary expressions):</p>
<p><div class="cs_displaymath cs_math_to_render" style="text-align:center;padding-bottom:10px;">\frac{\partial}{\partial x}c = 0</div></p>
<p><div class="cs_displaymath cs_math_to_render" style="text-align:center;padding-bottom:10px;">\frac{\partial}{\partial x}x = 1</div></p>
<p><div class="cs_displaymath cs_math_to_render" style="text-align:center;padding-bottom:10px;">\frac{\partial}{\partial x}\left(u + v\right) = \frac{\partial}{\partial x}u + \frac{\partial}{\partial x}v</div></p>
<p><div class="cs_displaymath cs_math_to_render" style="text-align:center;padding-bottom:10px;">\frac{\partial}{\partial x}\left(u - v\right) = \frac{\partial}{\partial x}u - \frac{\partial}{\partial x}v</div></p>
<p><div class="cs_displaymath cs_math_to_render" style="text-align:center;padding-bottom:10px;">\frac{\partial}{\partial x}\left(u\cdot v\right) = u\left(\frac{\partial}{\partial x}v\right) + v\left(\frac{\partial}{\partial x}u\right)</div></p>
<p><div class="cs_displaymath cs_math_to_render" style="text-align:center;padding-bottom:10px;">\frac{\partial}{\partial x}\left(\frac{u}{v}\right) = \frac{v\left(\frac{\partial}{\partial x}u\right) - u\left(\frac{\partial}{\partial x}v\right)}{v^2}</div></p>
<p>Even though it may not be obvious from looking at first glance, these
mathematical definitions are recursive! That is to say, partial derivatives of
compound expressions are defined in terms of partial derivatives of component
parts, which may suggest strategies for implementing these rules in your
program!</p>
<p>Implement differentiation by adding a method called <code>deriv</code> to your classes.
This method should take a single argument (a string containing the name of the
variable with respect to which we are differentiating), and it should return a
symbolic expression representing the result of the differentiation.  For example:</p>
<pre><code class="language-py">&gt;&gt;&gt; x = Var('x')
&gt;&gt;&gt; y = Var('y')
&gt;&gt;&gt; z = 2*x - x*y + 3*y
&gt;&gt;&gt; print(z.deriv('x'))  # unsimplified, but the following gives us (2 - y)
2 * 1 + x * 0 - (x * 0 + y * 1) + 3 * 0 + y * 0
&gt;&gt;&gt; print(z.deriv('y'))  # unsimplified, but the following gives us (-x + 3)
2 * 0 + x * 0 - (x * 1 + y * 0) + 3 * 1 + y * 0
&gt;&gt;&gt; w = Div(x, y)
&gt;&gt;&gt; print(w.deriv('x'))
(y * 1 - x * 0) / (y * y)
&gt;&gt;&gt; print(repr(w.deriv('x')))  # deriv always returns a new Expr object
Div(Sub(Mul(Var('y'), Num(1)), Mul(Var('x'), Num(0))), Mul(Var('y'), Var('y')))
</code></pre>
<p>Importantly, we would like computing any derivative to result in a symbolic
expression.  Make sure that your code has this property!</p>
<p><a class="anchor" name="catsoop_section_9"></a><a class="anchor" name="_simplification"></a><h2 class="cs_section_title">9) Simplification<a class="cs_permalink" href="#_simplification">Â§</a></h2></p>
<p>The above code works, but it leads to output that is not very readable (it is
very difficult to see, for example, that the above examples correspond to <span class="cs_math_to_render">2-y</span>
and <span class="cs_math_to_render">-x+3</span>, respectively).  To help with this, add a method called
<code>simplify</code> to your class(es).  <code>simplify</code> should take no arguments, and it
should return a simplified form of the expression, according to the following
rules:</p>
<ul>
<li>Any binary operation on two numbers should simplify to a single number containing the result.</li>
<li>Adding <span class="cs_math_to_render">0</span> to (or subtracting <span class="cs_math_to_render">0</span> from) any expression <span class="cs_math_to_render">E</span> should simplify to <span class="cs_math_to_render">E</span>.</li>
<li>Multiplying or dividing any expression <span class="cs_math_to_render">E</span> by <span class="cs_math_to_render">1</span> should simplify to <span class="cs_math_to_render">E</span>.</li>
<li>Multiplying any expression <span class="cs_math_to_render">E</span> by <span class="cs_math_to_render">0</span> should simplify to <span class="cs_math_to_render">0</span>.</li>
<li>Dividing <span class="cs_math_to_render">0</span> by any expression <span class="cs_math_to_render">E</span> should simplify to <span class="cs_math_to_render">0</span>.</li>
<li>A single number or variable always simplifies to itself.</li>
</ul>
<div class="question"><b>Check Yourself:</b><p>Think about the simplification rules described above in terms of algebraic expressions and
work through simplifying some example expressions by hand to get a feel for how
these rules work.  Do these rules seem to work in a general sense -- will they always
work across our different operations and across different levels of expression complexity,
producing sensible simplifications?
Why?</p><p><span id="queue_checkyourself_5"></span></p></div>
<p>Your simplification method does not need to handle cases like <span class="cs_math_to_render">3 + (x + 2)</span>,
where the terms that could be combined are separated from each other in the
tree.  In fact, our test cases are expecting <strong>only</strong> the above rules to be
implemented.  Implementing extra rules here can be a great opportunity for
extra practice, but it will cause some test cases to fail (so maybe best to
implement such things only after submitting!).</p>
<p>For example, continuing from above:</p>
<pre><code class="language-py">&gt;&gt;&gt; z = 2*x - x*y + 3*y
&gt;&gt;&gt; print(z.simplify())
2 * x - x * y + 3 * y
&gt;&gt;&gt; print(z.deriv('x'))
2 * 1 + x * 0 - (x * 0 + y * 1) + 3 * 0 + y * 0
&gt;&gt;&gt; print(z.deriv('x').simplify())
2 - y
&gt;&gt;&gt; print(z.deriv('y'))
2 * 0 + x * 0 - (x * 1 + y * 0) + 3 * 1 + y * 0
&gt;&gt;&gt; print(z.deriv('y').simplify())
0 - x + 3
&gt;&gt;&gt; Add(Add(Num(2), Num(-2)), Add(Var('x'), Num(0))).simplify()
Var('x')
</code></pre>
<div class="callout callout-note"><div class="callout-title">Comparing Against 0 and 1</div>
<p>Note that many of the simplification rules above require checking to see whether
an expression is equal to <code>0</code> or <code>1</code>.  It will be important to be careful and
make sure this check is being done properly.  The following example demonstrates
one possible issue that can arise:</p><pre><code class="language-py">&gt;&gt;&gt; x = Num(0)
&gt;&gt;&gt; y = Num(0)
&gt;&gt;&gt; x == y
False
</code></pre><p>By default, Python doesn't know how to compare two instances of <code>Num</code> to see
if they are equal, so you will need to add some code of your own for this.</p><p>You can implement this in many ways (for example, by adding methods to your
classes).  Note also that you can specify how Python should check the <code>==</code>
condition by implementing a <a href="https://docs.python.org/3/reference/datamodel.html#object.__eq__" target="_blank"><code>__eq__</code></a> method in your classes if you want.</p>
</div>
<div class="callout callout-note"><div class="callout-title">Additional Considerations:</div>
<ul>
<li>
<p>Your <code>simplify</code> method should not mutate self.</p>
</li>
<li>
<p>Simplification should always result in a symbolic expression.  Make sure that your code has this property!</p>
</li>
<li>
<p>You may use type checking to determine whether a symbol represents a <code>Num</code> as part
of implementing this behavior.</p>
</li>
</ul>
</div>
<p><a class="anchor" name="catsoop_section_10"></a><a class="anchor" name="_parsing_symbolic_expressions"></a><h2 class="cs_section_title">10) Parsing Symbolic Expressions<a class="cs_permalink" href="#_parsing_symbolic_expressions">Â§</a></h2></p>
<p>Next, we would like to support parsing strings into symbolic expressions (to
provide yet another means of input).  For example, we would like to do
something like:</p>
<pre><code class="language-py">&gt;&gt;&gt; make_expression('(x * (2 + 3))')
Mul(Var('x'), Add(Num(2), Num(3)))
</code></pre>
<p>Define a stand-alone function called <code>make_expression</code>, which takes a single string as input.  This string should contain either:</p>
<ul>
<li>a single variable name,</li>
<li>a single number, or</li>
<li>a fully parenthesized expression of the form <code>(E1 op E2)</code>, representing a binary operation (where <code>E1</code> and <code>E2</code> are themselves strings representing expressions, and <code>op</code> is one of <code>+</code>, <code>-</code>, <code>*</code>, or <code>/</code>).</li>
</ul>
<p>You may assume that the string is always well-formed and fully parenthesized
(you do not need to handle erroneous input), but it should work for arbitrarily
deep nesting of expressions.</p>
<p>This process is often broken down into two pieces: <em>tokenizing</em> (to break the input string into meaningful units) and <em>parsing</em> (to build our internal representation from those units).</p>
<p><a class="anchor" name="catsoop_section_10_1"></a><a class="anchor" name="_tokenizing"></a><h3 class="cs_section_title">10.1) Tokenizing<a class="cs_permalink" href="#_tokenizing">Â§</a></h3></p>
<p>A good helper function to write is <code>tokenize</code>, which should take a string as
described above as input and should output a list of meaningful <em>tokens</em>
(parentheses, variable names, numbers, or operands).</p>
<p>For our purposes, you may assume that variables are always single-character
alphabetic characters and that all numbers are positive or negative integers or floats.
You may also assume that there are spaces separating operands and operators.</p>
<p>As an example:</p>
<pre><code class="language-py">&gt;&gt;&gt; tokenize("(x * (2 + 3))")
['(', 'x', '*', '(', '2', '+', '3', ')', ')']
</code></pre>
<p>Note that your code should also be able to handle numbers with more than one
digit and negative numbers!  A number like -200.5, for example, should be
represented by a single token <code>'-200.5'</code>.</p>
<p><a class="anchor" name="catsoop_section_10_2"></a><a class="anchor" name="_parsing"></a><h3 class="cs_section_title">10.2) Parsing<a class="cs_permalink" href="#_parsing">Â§</a></h3></p>
<p>Another helper function, <code>parse</code>, could take the output of <code>tokenize</code> and
convert it into an appropriate instance of <code>Expr</code> (or some subclass thereof).
For example:</p>
<pre><code class="language-py">&gt;&gt;&gt; tokens = tokenize("(x * (2 + 3))")
&gt;&gt;&gt; parse(tokens)
Mul(Var('x'), Add(Num(2), Num(3)))
</code></pre>
<p>Our "little language" for representing symbolic expressions can be parsed using
a <em>recursive-descent</em> parser.  One way to structure <code>parse</code> is as follows:</p>
<pre><code class="language-py">def parse(tokens):
   def parse_expression(index):
       pass  # your code here
   parsed_expression, next_index = parse_expression(0)
   return parsed_expression
</code></pre>
<p>The function <code>parse_expression</code> is a recursive function that takes as an argument an integer indexing into the <code>tokens</code> list and returns a pair of values:</p>
<ul>
<li>the expression found starting at the location given by <code>index</code> (an instance of one of the <code>Expr</code> subclasses), and</li>
<li>the index beyond where this expression ends (e.g., if the expression ends at the token with index <code>6</code> in the <code>tokens</code> list, then the returned value should be <code>7</code>).</li>
</ul>
<p>In the definition of this procedure, we make sure that we call it with the value <code>index</code> corresponding to the start of an expression.  So, we need to handle three cases.  Let <code>token</code> be the token at location <code>index</code>; the cases are:</p>
<ul>
<li>
<p><strong>Number</strong>: If <code>token</code> represents an integer or a float, then make a corresponding <code>Num</code> instance and return that, paired with <code>index + 1</code> (since a number is represented by a single token).</p>
</li>
<li>
<p><strong>Variable</strong>: If <code>token</code> represents a variable name (a single alphabetic character), then make a corresponding <code>Var</code> instance and return that, paired with <code>index + 1</code> (since a variable is represented by a single token).</p>
</li>
<li>
<p><strong>Operation</strong>: Otherwise, the sequence of tokens starting at <code>index</code> must be of the form: <code>(E1 op E2)</code>.  Therefore, <code>token</code> must be <code>(</code>.  In this case, we need to recursively parse the two subexpressions, combine them into an appropriate instance of a subclass of <code>BinOp</code> (determined by <code>op</code>), and return that instance, along with the index of the token beyond the final right parenthesis.</p>
</li>
</ul>
<p>You should write testcases (either doctests or test functions) in <code>lab.py</code>
for <code>make_expression</code> and any associated helper functions before implementing these behaviors. <strong>These test cases will be discussed as part of your checkoff.</strong></p>
<p>After writing your tests, implement the <code>make_expression</code> function in your code (possibly using the helper functions described above).</p>
<p><strong>Your implementation of the function <code>make_expression</code> should not use
Python's built-in <code>eval</code>, <code>exec</code>, <code>type</code>, or <code>isinstance</code> functions.</strong></p>
<p>However, you can <i>try</i> to cast a string to a float:</p>
<pre><code class="language-py">&gt;&gt;&gt; float("1")
1.0
&gt;&gt;&gt; float("-6.5")
-6.5
&gt;&gt;&gt; float("x")
...
ValueError: could not convert string to float: 'x'
</code></pre>
<p><a class="anchor" name="catsoop_section_11"></a><a class="anchor" name="_type_checking_considerations"></a><h2 class="cs_section_title">11) Type Checking Considerations<a class="cs_permalink" href="#_type_checking_considerations">Â§</a></h2></p>
<p>Throughout the lab we have mentioned only a few places where you are allowed
to use type checking. These places include:</p>
<ul>
<li><a href="https://docs.python.org/3/reference/datamodel.html#object.__init__" target="_blank"><code>__init__</code></a></li>
<li><code>simplify</code></li>
</ul>
<p>Otherwise, type checking is not allowed.  This is to ensure that two key stylistic
principles of class inheritance are followed:</p>
<ol>
<li>Properties and behavior that are general to all subclasses should be
defined in the parent class (this reduces repetition in sub-classes.)</li>
<li>Properties and behavior specific to a certain subclass should be defined
in that subclass (this reduces type-checking in parent classes.)</li>
</ol>
<p>A large part of this lab's checkoff conversation focuses on style and
avoiding unnecessary type checking, so taking time to refactor your code and
make sure there is no disallowed type checking is strongly advised. If you have
questions about whether your code is type checking, please come to open lab
hours or email <code>6.101-help@mit.edu</code>.</p>
<p><a class="anchor" name="catsoop_section_12"></a><a class="anchor" name="_code_submission"></a><h2 class="cs_section_title">12) Code Submission<a class="cs_permalink" href="#_code_submission">Â§</a></h2></p>
<p>When you have tested your code sufficiently on your own machine, submit your
modified <code>lab.py</code> using the <code>6.101-submit</code> script.</p>
<p>The following command should submit the lab, assuming that the last argument
<code>/path/to/lab.py</code> is replaced by the location of your <code>lab.py</code> file:</p>
<pre><code class="language-nohighlight">$ 6.101-submit -a symbolic_algebra /path/to/lab.py
</code></pre>
<p>Running that script should submit your file to be checked.  After
submitting your file, information about the checking process can be
found below:</p>
<p>
<!--START question code_submit --><section aria-label="Question">
<div class="question question-lab101_vprof" id="cs_qdiv_code_submit" style="position: static">
<div id="code_submit_rendered_question">
<div id="catsoop_preamble_code_submit"></div>
<div id="catsoop_prompt_code_submit" style="display: inline;"></div>When this page was loaded, you had not yet made any submissions.<br/>If you make a submission, results should show up here automatically; or you may click <a href="javascript:reload_code_submit();">here</a> or reload the page to see updated results.<br/>
</div><div>
<span id="code_submit_buttons"></span>
<span id="code_submit_loading_wrapper" role="status">
<span id="code_submit_loading" style="display:none;"><img class="catsoop-darkmode-invert" src="data:image/gif;base64,R0lGODlhEAAQAPIGAMLCwkJCQgAAAGJiYoKCgpKSkv///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAGACwAAAAAEAAQAAADMmi63P4wyklrAyEAGoQInAdOmGYBw7AxwLoMGcG2rkHEQFHQLTsQOd2mB9ERCpTWzpEAACH5BAkKAAYALAAAAgAKAA4AAAMraAYRoNAEIUJUs97VHgTD4EVDQ2xEM2wgMV5AUbyKLKNEvoxA3P8sYNCQAAAh+QQJCgAGACwAAAAACgAOAAADLWi6EAFrBSGCAmQ0as1wROFABuEM0TUQ5FUU7fK+aRkWNYDFqV4bOl8v+BMuEgAh+QQJCgAGACwAAAAADgAKAAADKmi6QAMrrhECkaaVVl+FRiFuAwEEghAoYxGhqgI0oPxlNSbPOcb3PqAkAQAh+QQJCgAGACwCAAAADgAKAAADKWhqUAUrLuekApA+MiDD4BYExAVGwzgsmNR0lgWMXmwEghDYCq7zDFoCACH5BAkKAAYALAYAAAAKAA4AAAMqaADWros9GEuRUBE7jeUTYGEhMZANEQREN6xDJ54PsKJGIAhBp/OyWyMBACH5BAkKAAYALAYAAgAKAA4AAAMpaKoA+609Fie1C5Tipt7WRhRWw0ED0T1DEAyMq7mEEghCAKTdnZcySwIAIfkEBQoABgAsAgAGAA4ACgAAAytoumwALb4X2YR1URACVkBRYIEgBIw4KuUJDERIzGD3doMhfguBZyAYT5EAADs="/><span class="screenreader-only-clip">Loading...</span></span>
</span>
<span id="code_submit_score_display" role="status"></span>
<div class="nsubmits_left" id="code_submit_nsubmits_left" role="status"></div></div>
<div id="code_submit_solution_container">
<div id="code_submit_solution">
</div>
<div id="code_submit_solution_explanation">
</div>
</div>
<div aria-atomic="true" id="code_submit_message" role="status"></div>
</div>
</section>
<!--END question code_submit -->
</p>
<div class="question"> Please log in to see Visual Profiler results. </div>
<p><a class="anchor" name="catsoop_section_13"></a><a class="anchor" name="_checkoff"></a><h2 class="cs_section_title">13) Checkoff<a class="cs_permalink" href="#_checkoff">Â§</a></h2></p>
<p>Once you are finished with the code, you will need to come (in person) to any
open lab time and add yourself to the <a href="https://py.mit.edu/spring25/queue">queue</a> asking for a
checkoff in order to receive credit for the lab.  <strong>You must be ready to
discuss your code in detail before asking for a checkoff.</strong></p>
<p>You should be prepared to demonstrate your code (which should be
well-commented, should avoid repetition, and should make good use of helper
functions; see the notes on <a href="https://py.mit.edu/spring25/readings/style">style</a> for more
information).  In particular, be prepared to discuss:</p>
<ul>
<li>Briefly describe your implementation of parenthesization.  How did you use inheritance to avoid repetitious code and to avoid explicitly checking the type of any of the objects?</li>
<li>Where did you implement the combination methods (e.g., <a href="https://docs.python.org/3/reference/datamodel.html#object.__add__" target="_blank"><code>__add__</code></a>, <a href="https://docs.python.org/3/reference/datamodel.html#object.__radd__" target="_blank"><code>__radd__</code></a>)?</li>
<li>Describe your implementation of the <code>evaluate</code> method.  How does your code avoid type checking and handle the case where not all of the necessary variables are specified?</li>
<li>Briefly describe your strategy for implementing <code>deriv</code> and <code>simplify</code>. What are the base cases and recursive cases for these methods? How does deriv avoid type checking?</li>
<li>Briefly describe your algorithm for <code>make_expression</code> and show the test cases you made to test the functionality of <code>make_expression</code> and any of its helper functions in the lab.</li>
</ul>
<div class="response"><i>You have not yet received this checkoff.  When you have completed this checkoff, you will see a grade here.</i></div>
<p><a class="anchor" name="catsoop_section_14"></a><a class="anchor" name="_additional_optional_extensions"></a><h2 class="cs_section_title">14) Additional (Optional) Extensions<a class="cs_permalink" href="#_additional_optional_extensions">Â§</a></h2></p>
<p>We think the program we've built here is pretty impressive!  But there
are many opportunities to improve and/or extend its behavior to do
even more impressive things. If you have the time and interest, there
are a number of ways that you could expand on this framework. Note that some
of these optional extensions may break the behavior the test cases are expecting, so it is a
good idea to finish and submit the lab before working on the optional extensions.
Some ideas are listed below:</p>
<ul>
<li>
<p>adding additional operations (like exponentiation!), including support for derivatives,
simplification, etc.</p>
</li>
<li>
<p>adding additional rules for simplification similar to those we've
seen above (for example, for any expression <span class="cs_math_to_render">u</span>, <span class="cs_math_to_render">u/u</span> could
simplify to <span class="cs_math_to_render">1</span>)</p>
</li>
<li>
<p>adding support for <a href="https://py.mit.edu/spring25/labs/symbolic_algebra/solver">solving systems of linear equations</a></p>
</li>
<li>
<p>modifying your code to be able to handle situations like <span class="cs_math_to_render">3 + (x+2)</span>,
where simplification is possible in theory, but where the
methods described above won't fully simplify the expression</p>
</li>
<li>
<p>adding more simplification rules relating addition to
multiplication, or multiplication to exponentiation (if you decided to add it).  For example,
could we simplify <span class="cs_math_to_render">x + x + x</span> to <span class="cs_math_to_render">3x</span>, or <span class="cs_math_to_render">(3y)(4y)</span> to <span class="cs_math_to_render">12y^2</span> ?</p>
</li>
<li>
<p>adding representations for polynomial expressions, which may provide
additional opportunities for simplification</p>
</li>
<li>
<p>modifying your linear equation solver so that it outputs partial
results even for systems that can't be solved (i.e., for systems
that are underconstrained)</p>
</li>
</ul>
<p>Feel free to implement your own ideas as well!
<script type="text/javascript">
        if (MathJax) {
            // Disable the MathJax right-click menu,
            // so that screenreader doesn't say "clickable" on every math element
            // Based on https://docs.mathjax.org/en/latest/web/configuration.html#configuring-mathjax-after-it-is-loaded
            MathJax.config.options = MathJax.config.options ?? {};
            MathJax.config.options.enableMenu = false;
            MathJax.startup.getComponents();
        }


        // give the hamburger menu icon an accessible label
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelector("a.icon")?.setAttribute('aria-label', 'site-menu');
        });
        
        // based on catsoop.modal
        catsoop.vprof_survey = function (header, text, vprof_link, link_timestamp) {
          return new Promise(function (resolve, reject) {
            var response = {
            "response": null,
            "vprof_link": vprof_link,
            "link_timestamp": link_timestamp,
            "response_timestamp": null,
            "make_modal_timestamp": Date.now(),
            };
            var content = document.createElement("dialog");
            content.classList = ["catsoop-modal-content"];
            content.setAttribute("aria-labelledby", "catsoop-dialog-header");
            content.setAttribute("aria-describedby", "catsoop-dialog-body");
            content.addEventListener("keydown", function (e) {
              // this piece traps focus in the dialog while it is open
              // based on https://hidde.blog/using-javascript-to-trap-focus-in-an-element/
              if (!content.open) {
                return;
              }
              if (e.key === "Tab" || e.keyCode === 9) {
                if (e.shiftKey) {
                  if (document.activeElement === content.focusable[0]) {
                    content.focusable[content.focusable.length - 1].focus();
                    e.preventDefault();
                  }
                } else if (
                  document.activeElement ===
                  content.focusable[content.focusable.length - 1]
                ) {
                  content.focusable[0].focus();
                  e.preventDefault();
                }
              }
            });
            content.focusable = [];

            var mbody = document.createElement("div");
            mbody.classList = ["catsoop-modal-body"];

            var close_button = document.createElement("button");
            close_button.classList = ["catsoop-modal-close"];
            close_button.innerHTML = "&times;";
            close_button.setAttribute("aria-label", "Close");
            close_button.onclick = function () {
              content.close(JSON.stringify(Object.assign(response, {"response": "cancel", "response_timestamp": Date.now()})));
            };
            content.focusable.push(close_button);
            mbody.append(close_button);

            var title = document.createElement("span");
            title.id = "catsoop-dialog-header";
            title.classList = ["catsoop-modal-header"];
            title.appendChild(document.createTextNode(header));
            title.setAttribute("role", "heading");
            mbody.appendChild(title);

            var body = document.createElement("p");
            body.id = "catsoop-dialog-body";
            body.innerHTML = text + "<br/>";
            mbody.appendChild(body);

            var buttons = document.createElement("span");
            var yes_button = document.createElement("button");
            yes_button.innerText = "Yes";
            yes_button.classList = ["btn btn-catsoop"];
            yes_button.addEventListener("click", function () {
              content.close(JSON.stringify(Object.assign(response, {"response": "yes", "response_timestamp": Date.now()})));
            });
            yes_button.setAttribute("autofocus", true);
            content.focusable.push(yes_button);


            var no_button = document.createElement("button");
            no_button.innerText = "No";
            no_button.classList = ["btn btn-catsoop"];
            no_button.addEventListener("click", function () {
              content.close(JSON.stringify(Object.assign(response, {"response": "no", "response_timestamp": Date.now()})));
            });
            content.focusable.push(no_button);

            buttons.appendChild(yes_button);
            buttons.appendChild(document.createTextNode(" "));
            buttons.appendChild(no_button);
            mbody.appendChild(buttons);

            content.addEventListener("close", function () {
              content.remove();
              last_clicked_vprof_report[0] = null;
              last_clicked_vprof_report[1] = null;
              showing_vprof_survey[0] = false;
              (content.returnValue === "" ? reject : resolve)(content.returnValue);
            });

            content.appendChild(mbody);
            document.body.appendChild(content);
            content.showModal();
          });
        };


        function postVprofSurveyResponse(value){
            var data = JSON.parse(value);
            var encoded_form_pairs = [];
            for (var name in data){
                encoded_form_pairs.push(encodeURIComponent(name) + '=' + encodeURIComponent(data[name]));
            }
            //console.log("data", data)
            var form = encoded_form_pairs.join('&').replace(/%20/g, '+');
            //console.log("form data", form);

            var request = new XMLHttpRequest();
            request.onload = function(){
                var msg = request.response;
                var data = JSON.parse(msg);
                //if(data.ok){
                //    console.log("post success")
                //}else{
                //    concole.log("post error", msg, JSON.stringify(data))
                //}
            }

            request.open('POST', "https://py.mit.edu/spring25/staffonly/analytics/vprof_survey_collector", true);
            request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            request.send(form);

        }

        var showing_vprof_survey = [false];
        var last_clicked_vprof_report = [null, null];

        document.addEventListener('visibilitychange', e=>{
          if (document.visibilityState === 'visible' &&
              last_clicked_vprof_report[0] !== null &&
              !showing_vprof_survey[0]) {
              // show vorif yes/no survey
              catsoop.vprof_survey("vprof survey",
                "Did <a href='" + last_clicked_vprof_report[0] + "' target='_blank'> this vprof report</a> help you find and/or fix an efficiency bug?",
                last_clicked_vprof_report[0], last_clicked_vprof_report[1]).then(postVprofSurveyResponse, postVprofSurveyResponse);
              showing_vprof_survey[0] = true;
            }
        })

        var vprof_links  = document.getElementsByClassName("vprof_link");
        for (var i=0; i < vprof_links.length; i++) {
            let my_link = vprof_links[i].href
            if ((typeof my_link === 'string' || my_link instanceof String) && !my_link.includes("#")) {
                vprof_links[i].href = my_link + '#78111110101-5a8a1e3f617e6a4d35394db299505c70891e32b6ef000e1aa29d2948a4ecd87f';
            }
            vprof_links[i].onclick = function(){
              last_clicked_vprof_report[0] = this.href;
              last_clicked_vprof_report[1] = Date.now();
            }
        }


    </script>
<script src="https://py.mit.edu/submission_nudger/socket.io/socket.io.js" type="text/javascript"></script>
<script type="text/javascript">
catsoop.nudger_id = 'd8c90c68c5d3f0b94150dd71146dbfd59bdd997fc4120112058c66ba10af1d4f';

var socket = io('https://py.mit.edu', {path: '/submission_nudger' + '/socket.io', autoConnect: false});

socket.on('connect', function(){
    socket.emit('hello', {id: catsoop.nudger_id});
});

socket.on('refresh', reload_code_submit);

socket.open();
</script></p>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:0b31508aeb0634b347b8270c7bee4d411b5d4109&dn=agpl-3.0.txt AGPL-v3
catsoop.all_questions = ['code_submit'];
catsoop.username = null;
catsoop.this_path = 'https://py.mit.edu/spring25/labs/symbolic_algebra';
catsoop.path_info = ['spring25', 'labs', 'symbolic_algebra'];
catsoop.course = 'spring25';
catsoop.url_root = 'https://py.mit.edu';
catsoop.imp = '';
catsoop.skip_alert = [];
catsoop.viewans_confirm = "Are you sure?  Viewing the answer will prevent any further submissions to this question.  Press 'OK' to view the answer, or press 'Cancel' if you have changed your mind.";

// @license-end</script>
<div id="cs_footnotes"><br/>Â <hr/><b name="cs_footnotes">Footnotes</b><p><a class="anchor" name="catsoop_footnote_1"></a><sup style="padding-right:0.25em;color:var(--cs-base-bg-color);">1</sup>Note that these
rules should be sufficient for the four operations we have implemented.  If we
wanted to add additional operations, we might need to reconsider these
rules. <a href="#catsoop_footnote_ref_1"><span class="noprint">(click to return to text)</span></a></p></div>
</div>
</div>
<div class="cs_right_menu"></div>
</div>
<footer>
<nav aria-label="Breadcrumbs" class="cs_navigation cs_bottom_navigation" id="cs_bottom_navigation"><li><a href="https://py.mit.edu/spring25">Home</a></li><li><a href="https://py.mit.edu/spring25/labs/symbolic_algebra">Symbolic Algebra</a></li></nav>
<div class="cs_footer">
      This page was last updated on Friday April 25, 2025 at 02:45:47 PM (revision <code>d0547850</code>).<br/>Â <br/>
<pre class="catsooplogo" style="font-size:50%;">\            
/    /\__/\  
\__=(  o_O )=
(__________) 
 |_ |_ |_ |_ </pre>
      Powered by <a href="https://catsoop.org" target="_blank">CAT-SOOP</a> v19.0.6+hg.14.f36ce1d1 "Korat" (LTS) (development snapshot).<br/>
      CAT-SOOP is <a href="https://www.fsf.org/about/what-is-free-software" target="_blank">Free/Libre Software</a>, available under the terms<br/>of the <a href="https://py.mit.edu/_util/license" target="_blank">GNU Affero General Public License, version 3</a>.<br/>
<a download="" href="https://py.mit.edu/_util/source.zip" target="_blank">Download Source Code</a><br/>
<a href="https://py.mit.edu/_util/jslicense.html" rel="jslicense" target="_blank">Javascript License Information</a>
</div>
</footer>
</body>
</html>

